###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         14/Jun/2016  16:50:07 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\FM1702SL\FM1702SL.c                #
#    Command line       =  -f F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç #
#                          \WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\U #
#                          tilities\SerialApp\CC2530DB\..\..\..\Tools\CC2530D #
#                          B\f8wEndev.cfg (-DCPU32MHZ -DROOT=__near_func      #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹â #
#                          ÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5. #
#                          1a\Projects\zstack\Utilities\SerialApp\CC2530DB\.. #
#                          \..\..\Tools\CC2530DB\f8wConfig.cfg (-DZIGBEEPRO   #
#                          -DSECURE=0 -DZG_SECURE_DYNAMIC=0 -DREFLECTOR       #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1001                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹â #
#                          ÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5. #
#                          1a\Projects\zstack\Utilities\SerialApp\FM1702SL\FM #
#                          1702SL.c -D NWK_AUTO_POLL -D HAL_UART=TRUE -D      #
#                          SERIAL_APP_PORT=0 -D xPOWER_SAVING -D NV_INIT -D   #
#                          FM1702SL -lC F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ #
#                          ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Project #
#                          s\zstack\Utilities\SerialApp\CC2530DB\FM1702SL\Lis #
#                          t\ -lA F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBee #
#                          ÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zsta #
#                          ck\Utilities\SerialApp\CC2530DB\FM1702SL\List\     #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\FM1702SL\Obj\ -e          #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç #
#                          \WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\U #
#                          tilities\SerialApp\CC2530DB\ -I                    #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\FM1702SL\ -I           #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\Public\ -I             #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\ZMain\TI2530DB\  #
#                          -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç #
#                          \WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\U #
#                          tilities\SerialApp\CC2530DB\..\..\..\..\..\Compone #
#                          nts\hal\include\ -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ× #
#                          ÊÁÏ210\ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\ #
#                          Projects\zstack\Utilities\SerialApp\CC2530DB\..\.. #
#                          \..\..\..\Components\hal\target\CC2530EB\ -I       #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \mac\include\ -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ #
#                          210\ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Pro #
#                          jects\zstack\Utilities\SerialApp\CC2530DB\..\..\.. #
#                          \..\..\Components\mac\high_level\ -I               #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \mac\low_level\srf04\ -I                           #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \mac\low_level\srf04\single_chip\ -I               #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \mt\ -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBe #
#                          eÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zst #
#                          ack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\Co #
#                          mponents\osal\include\ -I                          #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \services\saddr\ -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ× #
#                          ÊÁÏ210\ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\ #
#                          Projects\zstack\Utilities\SerialApp\CC2530DB\..\.. #
#                          \..\..\..\Components\services\sdata\ -I            #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \stack\af\ -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210 #
#                          \ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projec #
#                          ts\zstack\Utilities\SerialApp\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\nwk\ -I                       #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \stack\sapi\ -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ2 #
#                          10\ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Proj #
#                          ects\zstack\Utilities\SerialApp\CC2530DB\..\..\..\ #
#                          ..\..\Components\stack\sec\ -I                     #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \stack\sys\ -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ21 #
#                          0\ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Proje #
#                          cts\zstack\Utilities\SerialApp\CC2530DB\..\..\..\. #
#                          .\..\Components\stack\zdo\ -I                      #
#                          F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\..\..\..\..\..\Components #
#                          \zmac\ -I F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\Zig #
#                          BeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\z #
#                          stack\Utilities\SerialApp\CC2530DB\..\..\..\..\..\ #
#                          Components\zmac\f8w\ -Ohz --require_prototypes     #
#    List file          =  F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\FM1702SL\List\FM1702SL.ls #
#                          t                                                  #
#    Object file        =  F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WS #
#                          N-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Util #
#                          ities\SerialApp\CC2530DB\FM1702SL\Obj\FM1702SL.r51 #
#                                                                             #
#                                                                             #
###############################################################################

F:\¹âÅÌ×ÊÁÏ\ETC-WSNÎïÁªÍø¹âÅÌ×ÊÁÏ210\ZigBeeÍøÂç\WSN-CSÔ´Âë\ZStack-CC2530-2.5.1a\Projects\zstack\Utilities\SerialApp\FM1702SL\FM1702SL.c
      1          /**************************************************************************************************
      2            Filename:       SerialApp.c
      3            Revised:        $Date: 2009-03-29 10:51:47 -0700 (Sun, 29 Mar 2009) $
      4            Revision:       $Revision: 19585 $
      5          
      6            Description -   Serial Transfer Application (no Profile).
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED “AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          #include "AF.h"
     41          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0x80
   \   union <unnamed> volatile __sfr _A_P0
   \                     _A_P0:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0x90
   \   union <unnamed> volatile __sfr _A_P1
   \                     _A_P1:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfd
   \   unsigned char volatile __sfr P0DIR
   \                     P0DIR:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfe
   \   unsigned char volatile __sfr P1DIR
   \                     P1DIR:
   \   000000                DS 1
     42          #include "OSAL_Tasks.h"
     43          #include "ZDApp.h"
     44          #include "ZDObject.h"
     45          #include "ZDProfile.h"
     46          
     47          #include "hal_drivers.h"
     48          #include "hal_key.h"
     49          #if defined ( LCD_SUPPORTED )
     50            #include "hal_lcd.h"
     51          #endif
     52          #include "hal_led.h"
     53          #include "hal_uart.h"
     54          #include "Public.h"
     55          #include "fm1702sl.h"
     56          #include "spi.h"
     57          
     58          /*********************************************************************
     59           * MACROS
     60           */
     61          
     62          /*********************************************************************
     63           * CONSTANTS
     64           */
     65          
     66          #if !defined( SERIAL_APP_PORT )
     67          #define SERIAL_APP_PORT  0
     68          #endif
     69          
     70          #if !defined( SERIAL_APP_BAUD )
     71          #define SERIAL_APP_BAUD  HAL_UART_BR_19200
     72          #endif
     73          
     74          // When the Rx buf space is less than this threshold, invoke the Rx callback.
     75          #if !defined( SERIAL_APP_THRESH )
     76          #define SERIAL_APP_THRESH  64
     77          #endif
     78          
     79          #if !defined( SERIAL_APP_RX_SZ )
     80          #define SERIAL_APP_RX_SZ  128
     81          #endif
     82          
     83          #if !defined( SERIAL_APP_TX_SZ )
     84          #define SERIAL_APP_TX_SZ  128
     85          #endif
     86          
     87          // Millisecs of idle time after a byte is received before invoking Rx callback.
     88          #if !defined( SERIAL_APP_IDLE )
     89          #define SERIAL_APP_IDLE  6
     90          #endif
     91          
     92          // Loopback Rx bytes to Tx for throughput testing.
     93          #if !defined( SERIAL_APP_LOOPBACK )
     94          #define SERIAL_APP_LOOPBACK  FALSE
     95          #endif
     96          
     97          // This is the max byte count per OTA message.
     98          #if !defined( SERIAL_APP_TX_MAX )
     99          #define SERIAL_APP_TX_MAX  20
    100          #endif
    101          
    102          #define SERIAL_APP_RSP_CNT  4
    103          #define M1AREA 		0x01     //Òª²Ù×÷µÄÉÈÇøºÅ
    104           
    105          
    106          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    107          const cId_t SerialApp_ClusterList[SERIALAPP_MAX_CLUSTERS] =
   \                     SerialApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
    108          {
    109            SERIALAPP_CLUSTERID1,
    110            SERIALAPP_CLUSTERID2
    111          };
    112          

   \                                 In  segment XDATA_ROM_C, align 1
    113          const SimpleDescriptionFormat_t SerialApp_SimpleDesc =
   \                     SerialApp_SimpleDesc:
   \   000000   0B           DB 11
   \   000001   050F         DW 3845
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   02           DB 2
   \   000007   ....         DW SerialApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW SerialApp_ClusterList
    114          {
    115            SERIALAPP_ENDPOINT,              //  int   Endpoint;
    116            SERIALAPP_PROFID,                //  uint16 AppProfId[2];
    117            SERIALAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    118            SERIALAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    119            SERIALAPP_FLAGS,                 //  int   AppFlags:4;
    120            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    121            (cId_t *)SerialApp_ClusterList,  //  byte *pAppInClusterList;
    122            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumOutClusters;
    123            (cId_t *)SerialApp_ClusterList   //  byte *pAppOutClusterList;
    124          };
    125          

   \                                 In  segment XDATA_ROM_C, align 1
    126          const endPointDesc_t SerialApp_epDesc =
   \                     SerialApp_epDesc:
   \   000000   0B           DB 11
   \   000001   ....         DW SerialApp_TaskID
   \   000003   ....         DW SerialApp_SimpleDesc
   \   000005   00           DB 0
    127          {
    128            SERIALAPP_ENDPOINT,
    129           &SerialApp_TaskID,
    130            (SimpleDescriptionFormat_t *)&SerialApp_SimpleDesc,
    131            noLatencyReqs
    132          };
    133          
    134          /*********************************************************************
    135           * TYPEDEFS
    136           */
    137          
    138          /*********************************************************************
    139           * GLOBAL VARIABLES
    140           */
    141          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          uint8 SerialApp_TaskID;    // Task ID for internal task/event processing.
   \                     SerialApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    143          devStates_t  SampleApp_NwkState;
   \                     SampleApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    144          static UART_Format UART0_Format;
   \                     UART0_Format:
   \   000000                DS 16
   \   000010                REQUIRE __INIT_XDATA_Z
    145          
    146          /*********************************************************************
    147           * EXTERNAL VARIABLES
    148           */
    149          
    150          /*********************************************************************
    151           * EXTERNAL FUNCTIONS
    152           */
    153          
    154          /*********************************************************************
    155           * LOCAL VARIABLES
    156           */
    157          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          static uint8 SerialApp_MsgID;
   \                     SerialApp_MsgID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    159          static afAddrType_t SerialApp_TxAddr;
   \                     SerialApp_TxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    160          static uint8 SerialApp_TxBuf[SERIAL_APP_TX_MAX];
   \                     SerialApp_TxBuf:
   \   000000                DS 20
   \   000014                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    161          static uint8 SerialApp_TxLen;
   \                     SerialApp_TxLen:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    162          static uint8 RevBuffer[24];
   \                     RevBuffer:
   \   000000                DS 24
   \   000018                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    163          uint8  CardNo[5];
   \                     CardNo:
   \   000000                DS 5
   \   000005                REQUIRE __INIT_XDATA_Z
    164          /*********************************************************************
    165           * LOCAL FUNCTIONS
    166           */
    167          
    168          static void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt );
    169          void SerialApp_OTAData(afAddrType_t *txaddr,uint8 ID,void *p,uint8 len);
    170          static void SerialApp_CallBack(uint8 port, uint8 event);
    171          static void GPIOInit(void);
    172          void  WriteReg(int8 reg, int8 data);
    173          int8  ReadReg(int8 reg_ad);
    174          void  InitFM1702SL(void);
    175          uint8 Request(uint8 mode);
    176          void  Fifo_Write(uint8 *s, uint8 count);
    177          uint8 FM1702BusSel(void);
    178          uint8 Clear_FIFO(void);
    179          uint8 Fifo_Read(uint8 *buff);
    180          uint8 Command_Send(uint8 count, uint8 *buff, uint8 Comm_Set);
    181          uint8 Judge_Req(uint8 *buff);
    182          uint8 ReadCardNum(void);
    183          uint8 AntiColl(void);
    184          uint8 Check_UID(void);
    185          uint8 Select_Card(void);
    186          void  keyto(void);
    187          uint8 block_numset(uint8 block_num);
    188          uint8 Load_key_CPY(uint8 *buff);
    189          int8  M500HostCodeKey(uint8 *uncoded, uint8 *coded);   
    190          uint8 Authentication(uint8 *UID, uint8 SecNR);
    191          uint8 MIF_READ(uint8 *buff, uint8 Block_Adr);
    192          uint8 MIF_Write(uint8 *buff, uint8 Block_Adr);
    193          
    194          static void GPIOInit(void)
    195          {
    196            P1DIR |= 0x04;  //P12  output
    197            P0DIR |= 0x01;  //P00
    198            BEEP = 0;
    199          }
    200          
    201          //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~//
    202          //Ãû³Æ: rc531_register_write                                                   // 
    203          //¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖÍ¨¹ýSPI½Ó¿Ú¶ÔRC531ÖÐÒ»¸ö¼Ä´æÆ÷Ð´ÈëÖµ                         // 
    204          //                                                                             // 
    205          //ÊäÈë:                                                                        // 
    206          //     RC531Ä¿±ê¼Ä´æÆ÷µØÖ·ºÍÐ´ÈëÖµ                                             // 
    207          //                                                                             // 
    208          //Êä³ö:                                                                        // 
    209          //     N/A                                                                     // 
    210          //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~//

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    211          void WriteReg(int8 reg_ad, int8 reg_data)
   \                     WriteReg:
    212          {   
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FF           MOV     R7,A
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
    213              sck=0;                               //Ê±ÖÓ
   \   000009   C295         CLR     0x90.5
    214              reg_ad <<= 1;
    215              cs=0;                              //½Ó¿ÚÑ¡Í¨
   \   00000B   C294         CLR     0x90.4
    216              reg_ad &= 0x7F;                      //×î¸ßÎ»Îª0±íÊ¾Ð´
    217              SPIOneByte(reg_ad);     //Ð´µØÖ·
   \   00000D                ; Setup parameters for call to function SPIOneByte
   \   00000D   EF           MOV     A,R7
   \   00000E   C3           CLR     C
   \   00000F   33           RLC     A
   \   000010   547F         ANL     A,#0x7f
   \   000012   F9           MOV     R1,A
   \   000013   12....       LCALL   ??SPIOneByte?relay
    218              SPIOneByte(reg_data);  //Ð´Êý¾Ý
   \   000016                ; Setup parameters for call to function SPIOneByte
   \   000016   EE           MOV     A,R6
   \   000017   F9           MOV     R1,A
   \   000018   02....       LJMP    ?Subroutine0 & 0xFFFF
   \   00001B                REQUIRE _A_P1
    219              cs=1;
    220              return;
    221          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ??SPIOneByte?relay
   \   000003   D294         SETB    0x90.4
   \   000005                REQUIRE ??Subroutine21_0
   \   000005                ; // Fall through to label ??Subroutine21_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine21_0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    222          
    223          //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~//
    224          //Ãû³Æ: rc531_register_read                                                    // 
    225          //¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖÍ¨¹ýSPI½Ó¿Ú¶ÁÈ¡RC531ÖÐÒ»¸ö¼Ä´æÆ÷µÄÖµ                         // 
    226          //                                                                             // 
    227          //ÊäÈë:                                                                        // 
    228          //     RC531Ä¿±ê¼Ä´æÆ÷µØÖ·                                                     // 
    229          //                                                                             // 
    230          //Êä³ö:                                                                        // 
    231          //     Ä¿±ê¼Ä´æÆ÷µÄÖµ                                                          // 
    232          //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~//

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    233          int8 ReadReg(int8 reg_ad)
   \                     ReadReg:
    234          {   
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    235            int8 temp;
    236            sck=0;       //Ê±ÖÓ
   \   000007   C295         CLR     0x90.5
    237            MicroWait(6);
   \   000009                ; Setup parameters for call to function Onboard_wait
   \   000009   7A06         MOV     R2,#0x6
   \   00000B   7B00         MOV     R3,#0x0
   \   00000D   12....       LCALL   ??Onboard_wait?relay
    238            cs=0;      //½Ó¿ÚÑ¡Í¨¿ª
   \   000010   C294         CLR     0x90.4
    239            reg_ad <<= 1;                          //reg_ad×óÒÆÒ»Î»¸¶Öµ¸øreg_ad
    240            reg_ad |= 0x80;                        //reg_ad¸ú¡°0X80¡±»òÔËËãºó¸¶Öµ¸øreg_ad   ×î¸ßÎ»Îª1±íÊ¾¶Á
    241            SPIOneByte(reg_ad);
   \   000012                ; Setup parameters for call to function SPIOneByte
   \   000012   EE           MOV     A,R6
   \   000013   C3           CLR     C
   \   000014   33           RLC     A
   \   000015   4480         ORL     A,#0x80
   \   000017   F9           MOV     R1,A
   \   000018   12....       LCALL   ??SPIOneByte?relay
    242            temp=SPIOneByte(0x00);
   \   00001B                ; Setup parameters for call to function SPIOneByte
   \   00001B   7900         MOV     R1,#0x0
   \   00001D   02....       LJMP    ?Subroutine0 & 0xFFFF
   \   000020                REQUIRE _A_P1
    243            cs=1;
    244            return (temp);
    245          }
    246          /*×ÜÏßÑ¡Ôñ*/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    247          uint8 FM1702BusSel(void)
   \                     FM1702BusSel:
    248          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    249            uint8 i, temp;
    250            WriteReg(PageSel, 0x80); //Ñ¡Ôñ¼Ä´æÆ÷×é0
   \   000005                ; Setup parameters for call to function WriteReg
   \   000005   7A80         MOV     R2,#-0x80
   \   000007   7900         MOV     R1,#0x0
   \   000009   12....       LCALL   ??WriteReg?relay
    251            for(i = 0; i < 0xff; i++)
   \   00000C   7E00         MOV     R6,#0x0
    252            {
    253              temp = ReadReg(RFIDCommand); //¶ÁÈ¡ÕýÔÚÖ´ÐÐµÄÃüÁî
    254              if(temp == 0x00)	//Èç¹ûÃ»ÓÐÖ¸ÁîÖ´ÐÐ
   \                     ??FM1702BusSel_0:
   \   00000E                ; Setup parameters for call to function ReadReg
   \   00000E   7901         MOV     R1,#0x1
   \   000010   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   000013   700B         JNZ     ??FM1702BusSel_1
    255              {	
    256                WriteReg(PageSel,0x00); //»Ö¸´¼Ä´æÆ÷µÄÏßÐÔÑ°Ö·
   \   000015                ; Setup parameters for call to function WriteReg
   \   000015   7A00         MOV     R2,#0x0
   \   000017   7900         MOV     R1,#0x0
   \   000019   12....       LCALL   ??WriteReg?relay
    257                return TRUE;	
   \   00001C   7901         MOV     R1,#0x1
   \   00001E   8008         SJMP    ??FM1702BusSel_2
    258              }
    259            }
   \                     ??FM1702BusSel_1:
   \   000020   0E           INC     R6
   \   000021   74FF         MOV     A,#-0x1
   \   000023   6E           XRL     A,R6
   \   000024   70E8         JNZ     ??FM1702BusSel_0
    260            return FALSE;
   \   000026   7900         MOV     R1,#0x0
   \                     ??FM1702BusSel_2:
   \   000028   02....       LJMP    ??Subroutine21_0 & 0xFFFF
    261          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine20_0:
   \   000000   12....       LCALL   ??ReadReg?relay
   \   000003   E9           MOV     A,R1
   \   000004   22           RET
    262          
    263          /*********************************************************/
    264          //½âÊÍ£ºFIFO»º³åÆ÷µÄÐ´º¯Êý
    265          //ÊäÈë£ºÐ´ÈëµÄ×Ö½Ú¸öÊý £¬ÒªÐ´ÈëµÄÖµµÄ´æ·ÅÊ×µØÖ· 
    266          //Êä³ö£º
    267          /********************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    268          void Fifo_Write(uint8 *s, uint8 count)
   \                     Fifo_Write:
    269          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   89..         MOV     ?V0 + 3,R1
    270            uint8 i,temp;
    271            for(i=0;i<count;i++)
   \   00000B   75..00       MOV     ?V0 + 2,#0x0
   \   00000E   801B         SJMP    ??Fifo_Write_0
    272            {
    273              temp=*(s+i);
    274              WriteReg(FIFODaTa, temp);
   \                     ??Fifo_Write_1:
   \   000010                ; Setup parameters for call to function WriteReg
   \   000010   85....       MOV     ?V0 + 0,?V0 + 2
   \   000013   EE           MOV     A,R6
   \   000014   25..         ADD     A,?V0 + 0
   \   000016   F582         MOV     DPL,A
   \   000018   EF           MOV     A,R7
   \   000019   12....       LCALL   ??Subroutine24_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_43:
   \   00001C   FA           MOV     R2,A
   \   00001D   7902         MOV     R1,#0x2
   \   00001F   12....       LCALL   ??WriteReg?relay
    275              MicroWait(100);
   \   000022                ; Setup parameters for call to function Onboard_wait
   \   000022   7A64         MOV     R2,#0x64
   \   000024   7B00         MOV     R3,#0x0
   \   000026   12....       LCALL   ??Onboard_wait?relay
    276            }
   \   000029   05..         INC     ?V0 + 2
   \                     ??Fifo_Write_0:
   \   00002B   E5..         MOV     A,?V0 + 2
   \   00002D   C3           CLR     C
   \   00002E   95..         SUBB    A,?V0 + 3
   \   000030   40DE         JC      ??Fifo_Write_1
    277          }
   \   000032                REQUIRE ?Subroutine1
   \   000032                ; // Fall through to label ?Subroutine1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7F04         MOV     R7,#0x4
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine24_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET
    278          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    279          uint8 Fifo_Read(uint8 *buff)
   \                     Fifo_Read:
    280          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    281            uint8	temp;
    282            uint8	i;
    283            temp = ReadReg(FIFOLength);
   \   000009                ; Setup parameters for call to function ReadReg
   \   000009   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_21:
   \   00000C   F5..         MOV     ?V0 + 2,A
    284            if(temp == 0)
   \   00000E   7004         JNZ     ??Fifo_Read_0
    285            {
    286              return 0;
   \   000010   7900         MOV     R1,#0x0
   \   000012   802C         SJMP    ??Fifo_Read_1
    287            }
    288            if(temp >= 24)		
   \                     ??Fifo_Read_0:
   \   000014   C3           CLR     C
   \   000015   9418         SUBB    A,#0x18
   \   000017   4003         JC      ??Fifo_Read_2
    289            {
    290              temp = 24;	
   \   000019   75..18       MOV     ?V0 + 2,#0x18
    291            }
    292            for(i = 0; i < temp; i++)
   \                     ??Fifo_Read_2:
   \   00001C   75..00       MOV     ?V0 + 3,#0x0
   \   00001F   8016         SJMP    ??Fifo_Read_3
    293            {
    294              *(buff + i) = ReadReg(FIFODaTa);
   \                     ??Fifo_Read_4:
   \   000021                ; Setup parameters for call to function ReadReg
   \   000021   7902         MOV     R1,#0x2
   \   000023   12....       LCALL   ??ReadReg?relay
   \   000026   85....       MOV     ?V0 + 0,?V0 + 3
   \   000029   EE           MOV     A,R6
   \   00002A   25..         ADD     A,?V0 + 0
   \   00002C   F582         MOV     DPL,A
   \   00002E   EF           MOV     A,R7
   \   00002F   3400         ADDC    A,#0x0
   \   000031   F583         MOV     DPH,A
   \   000033   E9           MOV     A,R1
   \   000034   F0           MOVX    @DPTR,A
    295            }
   \   000035   05..         INC     ?V0 + 3
   \                     ??Fifo_Read_3:
   \   000037   E5..         MOV     A,?V0 + 3
   \   000039   C3           CLR     C
   \   00003A   95..         SUBB    A,?V0 + 2
   \   00003C   40E3         JC      ??Fifo_Read_4
    296            return temp;  
   \   00003E   A9..         MOV     R1,?V0 + 2
   \                     ??Fifo_Read_1:
   \   000040   80..         SJMP    ?Subroutine1
    297          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   7904         MOV     R1,#0x4
   \   000002                REQUIRE ??Subroutine20_0
   \   000002                ; // Fall through to label ??Subroutine20_0
    298          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    299          uint8 Judge_Req(uint8 *buff)
   \                     Judge_Req:
    300          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    301            uint8	temp1, temp2;
    302            temp1 = *buff;
   \   000004   8A82         MOV     DPL,R2
   \   000006   8B83         MOV     DPH,R3
   \   000008   E0           MOVX    A,@DPTR
   \   000009   F8           MOV     R0,A
    303            temp2 = *(buff + 1);
   \   00000A   A3           INC     DPTR
   \   00000B   E0           MOVX    A,@DPTR
   \   00000C   F9           MOV     R1,A
    304            if((temp1 == 0x02) || (temp1 == 0x04) || (temp1 == 0x05) || (temp1 == 0x53) || (temp1 == 0x03))
   \   00000D   7402         MOV     A,#0x2
   \   00000F   68           XRL     A,R0
   \   000010   6014         JZ      ??Judge_Req_0
   \   000012   7404         MOV     A,#0x4
   \   000014   68           XRL     A,R0
   \   000015   600F         JZ      ??Judge_Req_0
   \   000017   7405         MOV     A,#0x5
   \   000019   68           XRL     A,R0
   \   00001A   600A         JZ      ??Judge_Req_0
   \   00001C   7453         MOV     A,#0x53
   \   00001E   68           XRL     A,R0
   \   00001F   6005         JZ      ??Judge_Req_0
   \   000021   7403         MOV     A,#0x3
   \   000023   68           XRL     A,R0
   \   000024   7007         JNZ     ??Judge_Req_1
    305            {
    306              if (temp2 == 0x00)
   \                     ??Judge_Req_0:
   \   000026   E9           MOV     A,R1
   \   000027   7004         JNZ     ??Judge_Req_1
    307              {
    308                return TRUE;
   \   000029   7901         MOV     R1,#0x1
   \   00002B   8002         SJMP    ??Judge_Req_2
    309              }
    310            }
    311            return FALSE;
   \                     ??Judge_Req_1:
   \   00002D   7900         MOV     R1,#0x0
   \                     ??Judge_Req_2:
   \   00002F   02....       LJMP    ?Subroutine2 & 0xFFFF
    312          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   D083         POP     DPH
   \   000002   D082         POP     DPL
   \   000004   02....       LJMP    ?BRET
    313          /////////////////////////////////////////////////////////

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    314          void InitFM1702SL(void)
   \                     InitFM1702SL:
    315          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    316            FM1702_RSTPD=1;
   \   000004   D292         SETB    0x90.2
    317            MicroWait(150);			
   \   000006                ; Setup parameters for call to function Onboard_wait
   \   000006   7A96         MOV     R2,#-0x6a
   \   000008   7B00         MOV     R3,#0x0
   \   00000A   12....       LCALL   ??Onboard_wait?relay
    318            FM1702_RSTPD=0;				 
   \   00000D   C292         CLR     0x90.2
    319            MicroWait(150);	//¸´Î»1702SL
   \   00000F                ; Setup parameters for call to function Onboard_wait
   \   00000F   7A96         MOV     R2,#-0x6a
   \   000011   8002         SJMP    ??InitFM1702SL_0
    320              	
    321            while(ReadReg(RFIDCommand) != 0)
    322            {
    323              MicroWait(10); 
   \                     ??InitFM1702SL_1:
   \   000013                ; Setup parameters for call to function Onboard_wait
   \   000013   7A0A         MOV     R2,#0xa
   \                     ??InitFM1702SL_0:
   \   000015   7B00         MOV     R3,#0x0
   \   000017   12....       LCALL   ??Onboard_wait?relay
    324            }
   \   00001A                ; Setup parameters for call to function ReadReg
   \   00001A   7901         MOV     R1,#0x1
   \   00001C   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_27:
   \   00001F   70F2         JNZ     ??InitFM1702SL_1
    325            FM1702BusSel();  
   \   000021                ; Setup parameters for call to function FM1702BusSel
   \   000021   12....       LCALL   ??FM1702BusSel?relay
    326            WriteReg(InterruptEn,0x7f);		     
   \   000024                ; Setup parameters for call to function WriteReg
   \   000024   7A7F         MOV     R2,#0x7f
   \   000026   7906         MOV     R1,#0x6
   \   000028   12....       LCALL   ??WriteReg?relay
    327            WriteReg(InterruptRq,0x7f);            	
   \   00002B                ; Setup parameters for call to function WriteReg
   \   00002B   7A7F         MOV     R2,#0x7f
   \   00002D   7907         MOV     R1,#0x7
   \   00002F   12....       LCALL   ?Subroutine8 & 0xFFFF
    328            WriteReg(TxControl,0x5b);	
    329            WriteReg(RxControl2,0x01);
   \                     ??CrossCallReturnLabel_0:
   \   000032                ; Setup parameters for call to function WriteReg
   \   000032   7A01         MOV     R2,#0x1
   \   000034   791E         MOV     R1,#0x1e
   \   000036   12....       LCALL   ??WriteReg?relay
    330            WriteReg(RxWait,0x07);
   \   000039                ; Setup parameters for call to function WriteReg
   \   000039   7A07         MOV     R2,#0x7
   \   00003B   7921         MOV     R1,#0x21
   \   00003D   12....       LCALL   ??WriteReg?relay
    331            WriteReg(CryptoSelect,0x00);
   \   000040                ; Setup parameters for call to function WriteReg
   \   000040   7A00         MOV     R2,#0x0
   \   000042   7931         MOV     R1,#0x31
   \   000044   12....       LCALL   ??WriteReg?relay
    332          }  
   \   000047   02....       LJMP    ?Subroutine2 & 0xFFFF
   \   00004A                REQUIRE _A_P1

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   12....       LCALL   ??WriteReg?relay
   \   000003                ; Setup parameters for call to function WriteReg
   \   000003                ; Setup parameters for call to function WriteReg
   \   000003   7A5B         MOV     R2,#0x5b
   \   000005   7911         MOV     R1,#0x11
   \   000007   12....       LCALL   ??WriteReg?relay
   \   00000A   22           RET
    333          
    334          /****************************************************************/
    335          /*Ãû³Æ: Clear_FIFO */
    336          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖÇå¿ÕFM1715ÖÐFIFOµÄÊý¾Ý*/
    337          /*ÊäÈë: N/A */
    338          /*Êä³ö: TRUE, FIFO±»Çå¿Õ */
    339          /* FALSE, FIFOÎ´±»Çå¿Õ */
    340          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    341          uint8 Clear_FIFO(void)
   \                     Clear_FIFO:
    342          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    343            uint8  temp;
    344            uint16 i;
    345            temp = ReadReg(Control);
    346            temp = (temp | 0x01);
    347            WriteReg(Control, temp);
   \   000005                ; Setup parameters for call to function WriteReg
   \   000005                ; Setup parameters for call to function ReadReg
   \   000005   7909         MOV     R1,#0x9
   \   000007   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_28:
   \   00000A   4401         ORL     A,#0x1
   \   00000C   FA           MOV     R2,A
   \   00000D   7909         MOV     R1,#0x9
   \   00000F   12....       LCALL   ??WriteReg?relay
    348            for(i = 0; i < RF_TimeOut; i++) //¼ì²éFIFOÊÇ·ñ±»Çå¿Õ
   \   000012   7EFF         MOV     R6,#-0x1
   \   000014   7F0F         MOV     R7,#0xf
    349            {
    350              temp = ReadReg(FIFOLength);
    351              if(temp == 0)
   \                     ??Clear_FIFO_0:
   \   000016                ; Setup parameters for call to function ReadReg
   \   000016   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_22:
   \   000019   7004         JNZ     ??Clear_FIFO_1
    352              {
    353                return TRUE;
   \   00001B   7901         MOV     R1,#0x1
   \   00001D   8007         SJMP    ??Clear_FIFO_2
    354              }
    355            }
   \                     ??Clear_FIFO_1:
   \   00001F   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_8:
   \   000022   70F2         JNZ     ??Clear_FIFO_0
    356            return FALSE;
   \   000024   7900         MOV     R1,#0x0
   \                     ??Clear_FIFO_2:
   \   000026   02....       LJMP    ??Subroutine21_0 & 0xFFFF
    357          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   EE           MOV     A,R6
   \   000001   24FF         ADD     A,#-0x1
   \   000003   1E           DEC     R6
   \   000004   EF           MOV     A,R7
   \   000005   34FF         ADDC    A,#-0x1
   \   000007   FF           MOV     R7,A
   \   000008   EE           MOV     A,R6
   \   000009   4F           ORL     A,R7
   \   00000A   22           RET
    358          /****************************************************************/
    359          /*Ãû³Æ: Command_Send */
    360          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖÏòFM1715·¢ËÍÃüÁî¼¯µÄ¹¦ÄÜ */
    361          /*ÊäÈë: count, ´ý·¢ËÍÃüÁî¼¯µÄ³¤¶È*/
    362          /* buff, Ö¸Ïò´ý·¢ËÍÊý¾ÝµÄÖ¸Õë */
    363          /* Comm_Set, ÃüÁîÂë */
    364          /*Êä³ö: TRUE, ÃüÁî±»ÕýÈ·Ö´ÐÐ*/
    365          /* FALSE, ÃüÁîÖ´ÐÐ´íÎó*/
    366          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    367          uint8 Command_Send(uint8 count, uint8 *buff, uint8 Comm_Set)
   \                     Command_Send:
    368          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   89..         MOV     ?V0 + 1,R1
   \   000007   EA           MOV     A,R2
   \   000008   FE           MOV     R6,A
   \   000009   EB           MOV     A,R3
   \   00000A   FF           MOV     R7,A
   \   00000B   8C..         MOV     ?V0 + 0,R4
    369          	uint16   j;
    370          	uint8  temp;
    371          	WriteReg(RFIDCommand,0x00);
   \   00000D                ; Setup parameters for call to function WriteReg
   \   00000D   7A00         MOV     R2,#0x0
   \   00000F   7901         MOV     R1,#0x1
   \   000011   12....       LCALL   ??WriteReg?relay
    372          	Clear_FIFO();
   \   000014                ; Setup parameters for call to function Clear_FIFO
   \   000014   12....       LCALL   ??Clear_FIFO?relay
    373          	Fifo_Write(buff, count);   //°Ñ26HÐ´ÈëFIFO
   \   000017                ; Setup parameters for call to function Fifo_Write
   \   000017   A9..         MOV     R1,?V0 + 1
   \   000019   EE           MOV     A,R6
   \   00001A   FA           MOV     R2,A
   \   00001B   EF           MOV     A,R7
   \   00001C   FB           MOV     R3,A
   \   00001D   12....       LCALL   ??Fifo_Write?relay
    374          	WriteReg(RFIDCommand,Comm_Set);		/* ÃüÁîÖ´ÐÐ */
   \   000020                ; Setup parameters for call to function WriteReg
   \   000020   AA..         MOV     R2,?V0 + 0
   \   000022   7901         MOV     R1,#0x1
   \   000024   12....       LCALL   ??WriteReg?relay
    375          	for(j = 0; j < RF_TimeOut; j++) /* ¼ì²éÃüÁîÖ´ÐÐ·ñ */
   \   000027   7EFF         MOV     R6,#-0x1
   \   000029   7F0F         MOV     R7,#0xf
    376          	{
    377          	  temp = ReadReg(RFIDCommand);
    378          	  if(temp == 0x00)//Èç¹ûTEMPÎªÕæÖ´ÐÐIFÓï¾ä£¬·ñÔòÍË³öIFÓï¾ä
   \                     ??Command_Send_0:
   \   00002B                ; Setup parameters for call to function ReadReg
   \   00002B   7901         MOV     R1,#0x1
   \   00002D   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   000030   7004         JNZ     ??Command_Send_1
    379          	  {
    380          	    return TRUE;//ÍË³öFORÓï¾ä£¨´ø²ÎÊý·µ»Ø£©
   \   000032   7901         MOV     R1,#0x1
   \   000034   8007         SJMP    ??Command_Send_2
    381          	  }
    382          	}
   \                     ??Command_Send_1:
   \   000036   12....       LCALL   ?Subroutine14 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   000039   70F0         JNZ     ??Command_Send_0
    383          	return FALSE;
   \   00003B   7900         MOV     R1,#0x0
   \                     ??Command_Send_2:
   \   00003D                REQUIRE ?Subroutine3
   \   00003D                ; // Fall through to label ?Subroutine3
    384          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   7F02         MOV     R7,#0x2
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    385          
    386          //AÃÜÂëµÄ¼ÓÃÜ¸ñÊ½£º00 4¸ö×Ö½ÚµÄÐòÁÐºÅ ¿éºÅ£¨ÉÈÇøºÅ£©£¬¹²6¸ö×Ö½ÚµÄÃÜÔ¿

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    387          void keyto(void)
   \                     keyto:
    388          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    389            uint8 i;
    390            RevBuffer[4] = block_numset(3);
   \   000004                ; Setup parameters for call to function block_numset
   \   000004   7903         MOV     R1,#0x3
   \   000006   12....       LCALL   ??block_numset?relay
   \   000009   E9           MOV     A,R1
   \   00000A   90....       MOV     DPTR,#RevBuffer + 4
   \   00000D   F0           MOVX    @DPTR,A
    391            for(i = 0; i < 7; i++)
    392              RevBuffer[5 + i] = 0xff;		//Ä¬ÈÏÃÜÂë
   \   00000E   74FF         MOV     A,#-0x1
   \   000010   A3           INC     DPTR
   \   000011   7807         MOV     R0,#0x7
   \                     ??keyto_0:
   \   000013   F0           MOVX    @DPTR,A
   \   000014   A3           INC     DPTR
   \   000015   D8FC         DJNZ    R0,??keyto_0
    393          }
   \   000017   02....       LJMP    ?Subroutine2 & 0xFFFF
    394          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    395          uint8 block_numset(uint8 block_num)
   \                     block_numset:
    396          { 	
   \   000000                ; Saved register size: 0
   \   000000                ; Auto size: 0
   \   000000   E9           MOV     A,R1
   \   000001   F8           MOV     R0,A
    397            unsigned char temp,i;
    398            i = M1AREA;
    399            temp = block_num;
    400            while(i)
    401            {
    402              temp=temp+4;
    403              i--;
    404            }
    405            return temp;
   \   000002   7404         MOV     A,#0x4
   \   000004   28           ADD     A,R0
   \   000005   F9           MOV     R1,A
   \   000006   02....       LJMP    ?BRET
    406          }
    407          /****************************************************************/
    408          /*Ãû³Æ: Request */
    409          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖ¶Ô·ÅÈëFM1702²Ù×÷·¶Î§Ö®ÄÚµÄ¿¨Æ¬µÄRequest²Ù×÷*/
    410          /*ÊäÈë: mode: ALL(¼à²âËùÒÔFM1702²Ù×÷·¶Î§Ö®ÄÚµÄ¿¨Æ¬) */
    411          /* STD(¼à²âÔÚFM1702²Ù×÷·¶Î§Ö®ÄÚ´¦ÓÚHALT×´Ì¬µÄ¿¨Æ¬) */
    412          /*Êä³ö: FM1702_NOTAGERR: ÎÞ¿¨*/
    413          /* FM1702_OK: Ó¦´ðÕýÈ·*/
    414          /* FM1702_REQERR: Ó¦´ð´íÎó*/
    415          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    416          uint8 Request(uint8 mode)
   \                     Request:
    417          {	
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
    418            uint8 temp;	
    419            RevBuffer[0] = mode; //00x26
   \   000006   90....       MOV     DPTR,#RevBuffer
   \   000009   F0           MOVX    @DPTR,A
    420            WriteReg(0x11,0x58);//¹Ø·¢Éä¿ØÖÆ
   \   00000A                ; Setup parameters for call to function WriteReg
   \   00000A   7A58         MOV     R2,#0x58
   \   00000C   7911         MOV     R1,#0x11
   \   00000E   12....       LCALL   ?Subroutine8 & 0xFFFF
    421            WriteReg(0x11,0x5b);//¿ª·¢Éä¿ØÖÆ
    422            WriteReg(0x0f,0x07);          //address 0FH  µ÷ÕûÎ»µÄÖ¡¸ñÊ½	
   \                     ??CrossCallReturnLabel_1:
   \   000011                ; Setup parameters for call to function WriteReg
   \   000011   7A07         MOV     R2,#0x7
   \   000013   790F         MOV     R1,#0xf
   \   000015   12....       LCALL   ??WriteReg?relay
    423            temp = ReadReg(0x09);
    424            temp &= 0xf7;
    425            WriteReg(0x09,temp);
   \   000018                ; Setup parameters for call to function WriteReg
   \   000018                ; Setup parameters for call to function ReadReg
   \   000018   7909         MOV     R1,#0x9
   \   00001A   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_30:
   \   00001D   54F7         ANL     A,#0xf7
   \   00001F   FA           MOV     R2,A
   \   000020   7909         MOV     R1,#0x9
   \   000022   12....       LCALL   ??WriteReg?relay
    426            WriteReg(0x22,0x03);
   \   000025                ; Setup parameters for call to function WriteReg
   \   000025   12....       LCALL   ?Subroutine5 & 0xFFFF
    427            
    428            temp = Command_Send(1, RevBuffer, Transceive); //Ð´0x26µ½FIFO
    429            if(temp == FALSE)
   \                     ??CrossCallReturnLabel_18:
   \   000028   7901         MOV     R1,#0x1
   \   00002A   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_37:
   \   00002D   7004         JNZ     ??Request_0
    430            {
    431              return FALSE;	
   \                     ??Request_1:
   \   00002F   7900         MOV     R1,#0x0
   \   000031   801A         SJMP    ??Request_2
    432            }
    433            temp = Fifo_Read(RevBuffer);    //¶ÁÈ¡FIFOÀïÃæµÄÊý¾Ý¼°Êý¾Ý³¤¶È	
    434            if(temp == 2)
   \                     ??Request_0:
   \   000033                ; Setup parameters for call to function Fifo_Read
   \   000033   7A..         MOV     R2,#RevBuffer & 0xff
   \   000035   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   000037   12....       LCALL   ??Fifo_Read?relay
   \   00003A   E9           MOV     A,R1
   \   00003B   6402         XRL     A,#0x2
   \   00003D   70F0         JNZ     ??Request_1
    435            {
    436              temp = Judge_Req(RevBuffer); //¶Ô¿¨Æ¬¸´Î»Ó¦´ðÐÅºÅµÄÅÐ¶Ï·µ»ØÖµÊÇ·ñÕýÈ·
    437              if(temp == TRUE)
   \   00003F                ; Setup parameters for call to function Judge_Req
   \   00003F   7A..         MOV     R2,#RevBuffer & 0xff
   \   000041   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   000043   12....       LCALL   ??Judge_Req?relay
   \   000046   E9           MOV     A,R1
   \   000047   6401         XRL     A,#0x1
   \   000049   70E4         JNZ     ??Request_1
    438              {
    439                return TRUE;	
   \   00004B   7901         MOV     R1,#0x1
    440              }
    441            }
   \                     ??Request_2:
   \   00004D   02....       LJMP    ??Subroutine21_0 & 0xFFFF
    442            return FALSE;
    443          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   7A03         MOV     R2,#0x3
   \   000002                REQUIRE ??Subroutine19_0
   \   000002                ; // Fall through to label ??Subroutine19_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine19_0:
   \   000000   7922         MOV     R1,#0x22
   \   000002   12....       LCALL   ??WriteReg?relay
   \   000005                ; Setup parameters for call to function Command_Send
   \   000005                ; Setup parameters for call to function Command_Send
   \   000005                ; Setup parameters for call to function Command_Send
   \   000005   7C1E         MOV     R4,#0x1e
   \   000007   7A..         MOV     R2,#RevBuffer & 0xff
   \   000009   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine22_0:
   \   000000   12....       LCALL   ??Command_Send?relay
   \   000003   E9           MOV     A,R1
   \   000004   22           RET
    444          
    445          /****************************************************************/
    446          /*Ãû³Æ: Load_keyE */
    447          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖ°ÑE2ÖÐÃÜÂë´æÈëFM1702µÄkeyRevBufferÖÐ*/
    448          /*ÊäÈë: Secnr: EEÆðÊ¼µØÖ·*/
    449          /*Êä³ö: True: ÃÜÔ¿×°ÔØ³É¹¦*/
    450          /* False: ÃÜÔ¿×°ÔØÊ§°Ü*/
    451          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    452          uint8 Load_key_CPY(uint8 *buff)
   \                     Load_key_CPY:
    453          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 12
   \   000004   74F4         MOV     A,#-0xc
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    454            int8  status;
    455            uint8 coded_keys[12];
    456            uint8 temp;
    457            M500HostCodeKey(buff, coded_keys);////////////////	
   \   000009                ; Setup parameters for call to function M500HostCodeKey
   \   000009   85..82       MOV     DPL,?XSP + 0
   \   00000C   85..83       MOV     DPH,?XSP + 1
   \   00000F   AC82         MOV     R4,DPL
   \   000011   AD83         MOV     R5,DPH
   \   000013   12....       LCALL   ??M500HostCodeKey?relay
    458            temp=Command_Send(0x0c,coded_keys,LoadKey);/* LoadKey½«ÃÜÔ¿´ÓFIFO»º´æ¸´ÖÆµ½KEY»º´æ 0x19*/
    459            if(temp == FALSE)       //0x0cÎª12¸ö×Ö½Ú³¤¶È //coded_keysÎªÖ¸ÏòµØÖ·¼Ä´æÆ÷
   \   000016                ; Setup parameters for call to function Command_Send
   \   000016   7C19         MOV     R4,#0x19
   \   000018   85..82       MOV     DPL,?XSP + 0
   \   00001B   85..83       MOV     DPH,?XSP + 1
   \   00001E   AA82         MOV     R2,DPL
   \   000020   AB83         MOV     R3,DPH
   \   000022   790C         MOV     R1,#0xc
   \   000024   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_38:
   \   000027   7004         JNZ     ??Load_key_CPY_0
    460            {
    461              return FM1702_LOADKEYERR;
   \   000029   7913         MOV     R1,#0x13
   \   00002B   800F         SJMP    ??Load_key_CPY_1
    462            }
    463            status = (ReadReg(ErrorFlag)) & 0x40;//ÅÐ¶ÏloadkeyÖ´ÐÐÊÇ·ñÕýÈ·
   \                     ??Load_key_CPY_0:
   \   00002D                ; Setup parameters for call to function ReadReg
   \   00002D   790A         MOV     R1,#0xa
   \   00002F   12....       LCALL   ??Subroutine20_0 & 0xFFFF
    464            if (status==0x40)
   \                     ??CrossCallReturnLabel_31:
   \   000032   A2E6         MOV     C,0xE0 /* A   */.6
   \   000034   5004         JNC     ??Load_key_CPY_2
    465              return FM1702_AUTHERR;
   \   000036   7904         MOV     R1,#0x4
   \   000038   8002         SJMP    ??Load_key_CPY_1
    466            return FM1702_OK;
   \                     ??Load_key_CPY_2:
   \   00003A   7900         MOV     R1,#0x0
   \                     ??Load_key_CPY_1:
   \   00003C   740C         MOV     A,#0xc
   \   00003E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000041                REQUIRE ?Subroutine2
   \   000041                ; // Fall through to label ?Subroutine2
    467          }
    468          
    469          // ×ª»»ÃÜÔ¿¸ñÊ½
    470          ///////////////////////////////////////////////////////////////////////

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    471          int8 M500HostCodeKey(uint8 *uncoded, uint8 *coded)   
   \                     M500HostCodeKey:
    472          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    473            uint8 cnt = 0;
    474            uint8 ln  = 0;     
    475            uint8 hn  = 0;      
    476            for (cnt = 0; cnt < 6; cnt++)
   \   000005   7E00         MOV     R6,#0x0
    477            {
    478              ln = uncoded[cnt] & 0x0F;
   \                     ??M500HostCodeKey_0:
   \   000007   8E82         MOV     DPL,R6
   \   000009   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   00000C   540F         ANL     A,#0xf
   \   00000E   FF           MOV     R7,A
    479              hn = uncoded[cnt] >> 4;
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   C4           SWAP    A
   \   000011   540F         ANL     A,#0xf
   \   000013   F5..         MOV     ?V0 + 0,A
    480              coded[cnt * 2 + 1] = (~ln << 4) | ln;
   \   000015   E8           MOV     A,R0
   \   000016   C3           CLR     C
   \   000017   33           RLC     A
   \   000018   F8           MOV     R0,A
   \   000019   E4           CLR     A
   \   00001A   33           RLC     A
   \   00001B   F9           MOV     R1,A
   \   00001C   EC           MOV     A,R4
   \   00001D   28           ADD     A,R0
   \   00001E   F8           MOV     R0,A
   \   00001F   ED           MOV     A,R5
   \   000020   39           ADDC    A,R1
   \   000021   F9           MOV     R1,A
   \   000022   EF           MOV     A,R7
   \   000023   F4           CPL     A
   \   000024   C4           SWAP    A
   \   000025   54F0         ANL     A,#0xf0
   \   000027   4F           ORL     A,R7
   \   000028   8882         MOV     DPL,R0
   \   00002A   8983         MOV     DPH,R1
   \   00002C   A3           INC     DPTR
   \   00002D   F0           MOVX    @DPTR,A
    481              coded[cnt * 2 ] = (~hn << 4) | hn;
   \   00002E   E5..         MOV     A,?V0 + 0
   \   000030   F4           CPL     A
   \   000031   C4           SWAP    A
   \   000032   54F0         ANL     A,#0xf0
   \   000034   45..         ORL     A,?V0 + 0
   \   000036   8882         MOV     DPL,R0
   \   000038   8983         MOV     DPH,R1
   \   00003A   F0           MOVX    @DPTR,A
    482            }
   \   00003B   0E           INC     R6
   \   00003C   EE           MOV     A,R6
   \   00003D   C3           CLR     C
   \   00003E   9406         SUBB    A,#0x6
   \   000040   40C5         JC      ??M500HostCodeKey_0
    483            return 0;
   \   000042   7900         MOV     R1,#0x0
   \   000044   02....       LJMP    ??Subroutine21_0 & 0xFFFF
    484          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   A882         MOV     R0,DPL
   \   000002   EA           MOV     A,R2
   \   000003   28           ADD     A,R0
   \   000004                REQUIRE ??Subroutine23_0
   \   000004                ; // Fall through to label ??Subroutine23_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine23_0:
   \   000000   F582         MOV     DPL,A
   \   000002   EB           MOV     A,R3
   \   000003                REQUIRE ??Subroutine24_0
   \   000003                ; // Fall through to label ??Subroutine24_0
    485          
    486          /*¶ÁÈ¡¿¨ºÅ*/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    487          uint8 ReadCardNum(void)
   \                     ReadCardNum:
    488          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    489            uint8 st;
    490            st= AntiColl();
    491            if(st!=0)				 
   \   000004                ; Setup parameters for call to function AntiColl
   \   000004   12....       LCALL   ??AntiColl?relay
   \   000007   E9           MOV     A,R1
   \   000008   6004         JZ      ??ReadCardNum_0
    492              return (1);
   \                     ??ReadCardNum_1:
   \   00000A   7901         MOV     R1,#0x1
   \   00000C   8024         SJMP    ??ReadCardNum_2
    493            st = Select_Card();  //Ñ¡Ôñ¿¨Æ¬
    494            if(st!=0)
   \                     ??ReadCardNum_0:
   \   00000E                ; Setup parameters for call to function Select_Card
   \   00000E   12....       LCALL   ??Select_Card?relay
   \   000011   E9           MOV     A,R1
   \   000012   70F6         JNZ     ??ReadCardNum_1
    495              return (1);
    496            keyto();
   \   000014                ; Setup parameters for call to function keyto
   \   000014   12....       LCALL   ??keyto?relay
    497            st = Load_key_CPY(&RevBuffer[5]);
    498            if(st!=0)
   \   000017                ; Setup parameters for call to function Load_key_CPY
   \   000017   7A..         MOV     R2,#(RevBuffer + 5) & 0xff
   \   000019   7B..         MOV     R3,#((RevBuffer + 5) >> 8) & 0xff
   \   00001B   12....       LCALL   ??Load_key_CPY?relay
   \   00001E   E9           MOV     A,R1
   \   00001F   70E9         JNZ     ??ReadCardNum_1
    499              return (1);		       
    500            st = Authentication(CardNo, RevBuffer[4]);
    501            if(st!=0)
   \   000021                ; Setup parameters for call to function Authentication
   \   000021   90....       MOV     DPTR,#RevBuffer + 4
   \   000024   E0           MOVX    A,@DPTR
   \   000025   F9           MOV     R1,A
   \   000026   7A..         MOV     R2,#CardNo & 0xff
   \   000028   7B..         MOV     R3,#(CardNo >> 8) & 0xff
   \   00002A   12....       LCALL   ??Authentication?relay
   \   00002D   E9           MOV     A,R1
   \   00002E   70DA         JNZ     ??ReadCardNum_1
    502              return (1);
    503            return (0);
   \   000030   7900         MOV     R1,#0x0
   \                     ??ReadCardNum_2:
   \   000032   02....       LJMP    ?Subroutine2 & 0xFFFF
    504          }
    505          
    506          /****************************************************************/
    507          /*Ãû³Æ: Authentication */
    508          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖÃÜÂëÈÏÖ¤µÄ¹ý³Ì*/
    509          /*ÊäÈë: UID: ¿¨Æ¬ÐòÁÐºÅµØÖ·*/
    510          /* SecNR: ÉÈÇøºÅ*/
    511          /*Êä³ö: FM1702_NOTAGERR: ÎÞ¿¨*/
    512          /* FM1702_PARITYERR: ÆæÅ¼Ð£Ñé´í*/
    513          /* FM1702_CRCERR: CRCÐ£Ñé´í*/
    514          /* FM1702_OK: Ó¦´ðÕýÈ·*/
    515          /* FM1702_AUTHERR: È¨ÍþÈÏÖ¤ÓÐ´í*/
    516          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    517          uint8 Authentication(uint8 *UID, uint8 SecNR)
   \                     Authentication:
    518          {	
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
    519            uint8 i;
    520            uint8 temp, temp1;	
    521            RevBuffer[0] = RF_CMD_AUTH_LA;   //ÃÜÂëA   
   \   000007   90....       MOV     DPTR,#RevBuffer
   \   00000A   7460         MOV     A,#0x60
   \   00000C   F0           MOVX    @DPTR,A
    522            RevBuffer[1] = SecNR;  
   \   00000D   EE           MOV     A,R6
   \   00000E   A3           INC     DPTR
   \   00000F   F0           MOVX    @DPTR,A
    523            for(i = 0; i < 4; i++)
   \   000010   7C00         MOV     R4,#0x0
    524            RevBuffer[2 + i] = UID[i];//°ÑÐòÁÐºÅ·ÅÈë»º³åÇøÊÇ·ñÎªÍ¬Ò»ÕÅ¿¨	  
   \                     ??Authentication_0:
   \   000012   8C82         MOV     DPL,R4
   \   000014   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_49:
   \   000017   C0E0         PUSH    A
   \   000019   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   00001C   D0E0         POP     A
   \   00001E   F0           MOVX    @DPTR,A
   \   00001F   0C           INC     R4
   \   000020   EC           MOV     A,R4
   \   000021   C3           CLR     C
   \   000022   9404         SUBB    A,#0x4
   \   000024   40EC         JC      ??Authentication_0
    525            WriteReg(ChannelRedundancy, 0x0f);  //·ñÔòÑéÖ¤²»Í¨¹ý
   \   000026                ; Setup parameters for call to function WriteReg
   \   000026   7A0F         MOV     R2,#0xf
   \   000028   7922         MOV     R1,#0x22
   \   00002A   12....       LCALL   ??WriteReg?relay
    526          //************ Authent1=0x0c ÑéÖ¤ÃüÁîÈÏÖ¤¹ý³ÌµÚ1²½ ****************//	
    527            temp = Command_Send(6, RevBuffer, Authent1);
    528            if(temp == FALSE)   			
   \   00002D                ; Setup parameters for call to function Command_Send
   \   00002D   7C0C         MOV     R4,#0xc
   \   00002F   7A..         MOV     R2,#RevBuffer & 0xff
   \   000031   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   000033   7906         MOV     R1,#0x6
   \   000035   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_39:
   \   000038   7004         JNZ     ??Authentication_1
    529              return FM1702_AUTHERR;	
   \                     ??Authentication_2:
   \   00003A   7904         MOV     R1,#0x4
   \   00003C   8018         SJMP    ??Authentication_3
    530          //************ Authent2=0x14 ÑéÖ¤ÃüÁîÈÏÖ¤¹ý³ÌµÚ2²½ ****************//
    531            temp = Command_Send(0, RevBuffer, Authent2);//Èç¹ûÃÜÂë´íÔòµÚ¶þ²½²»Í¨¹ý
    532            if(temp == FALSE)			
   \                     ??Authentication_1:
   \   00003E                ; Setup parameters for call to function Command_Send
   \   00003E   7C14         MOV     R4,#0x14
   \   000040   7A..         MOV     R2,#RevBuffer & 0xff
   \   000042   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   000044   7900         MOV     R1,#0x0
   \   000046   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_40:
   \   000049   60EF         JZ      ??Authentication_2
    533              return FM1702_AUTHERR;
    534            temp1 = ReadReg(Control);//¶Á¿ØÖÆ±êÊ¶¼Ä´æÆ÷Îª0X08Ê±±íÊ¾¼ÓÃÜµ¥Ôª´ò¿ª£¬
    535            temp1 = temp1 & 0x08;	//Í¨¹ýºó¸ÃÎ»ÄÚ²¿ÖÃ1 £¨CRYPTO1ON£©
    536            if(temp1 == 0x08)
   \   00004B                ; Setup parameters for call to function ReadReg
   \   00004B   7909         MOV     R1,#0x9
   \   00004D   12....       LCALL   ??Subroutine20_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_32:
   \   000050   5408         ANL     A,#0x8
   \   000052   60E6         JZ      ??Authentication_2
    537              return (0);
   \   000054   7900         MOV     R1,#0x0
   \                     ??Authentication_3:
   \   000056   80..         SJMP    ??Subroutine21_0
    538            return FM1702_AUTHERR;
    539          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   74..         MOV     A,#(RevBuffer + 2) & 0xff
   \   000002   28           ADD     A,R0
   \   000003   F582         MOV     DPL,A
   \   000005   74..         MOV     A,#((RevBuffer + 2) >> 8) & 0xff
   \   000007   3400         ADDC    A,#0x0
   \   000009   F583         MOV     DPH,A
   \   00000B   22           RET
    540          
    541          /****************************************************************/
    542          /*Ãû³Æ: Select_Card */
    543          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖ¶Ô·ÅÈëFM1702²Ù×÷·¶Î§Ö®ÄÚµÄÄ³ÕÅ¿¨Æ¬½øÐÐÑ¡Ôñ*/
    544          /*ÊäÈë: N/A */
    545          /*Êä³ö: FM1702_NOTAGERR: ÎÞ¿¨*/
    546          /* FM1702_PARITYERR: ÆæÅ¼Ð£Ñé´í*/
    547          /* FM1702_CRCERR: CRCÐ£Ñé´í*/
    548          /* FM1702_BYTECOUNTERR: ½ÓÊÕ×Ö½Ú´íÎó*/
    549          /* FM1702_OK: Ó¦´ðÕýÈ·*/
    550          /* FM1702_SELERR: Ñ¡¿¨³ö´í*/
    551          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    552          uint8 Select_Card(void)
   \                     Select_Card:
    553          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 0
    554            uint8 temp, i;	
    555          
    556            RevBuffer[0] = RF_CMD_SELECT;//Ð´0x93ÃüÁîÊ±¹Ø±Õ·¢ËÍÒÔ¼°½ÓÊÕCRCÐ£ÑéÒÔ¼°¿ªÆôÆæÐ£Ñé
   \   000004   90....       MOV     DPTR,#RevBuffer
   \   000007   7493         MOV     A,#-0x6d
   \   000009   F0           MOVX    @DPTR,A
    557            RevBuffer[1] = 0x70; //µ±·¢ËÍPICC_REQSTD ÃüÁîÊ±RegBitFraming Òª×°Èë0x07
   \   00000A   A3           INC     DPTR
   \   00000B   7470         MOV     A,#0x70
   \   00000D   F0           MOVX    @DPTR,A
    558            for(i = 0; i < 5; i++)
   \   00000E   7A00         MOV     R2,#0x0
    559            {
    560              RevBuffer[i + 2] = CardNo[i];  //°Ñ5¸ö¿¨ÐòÁÐºÅ×ª·ÅÈë»º³åÇø
   \                     ??Select_Card_0:
   \   000010   8A82         MOV     DPL,R2
   \   000012   A882         MOV     R0,DPL
   \   000014   74..         MOV     A,#CardNo & 0xff
   \   000016   28           ADD     A,R0
   \   000017   F582         MOV     DPL,A
   \   000019   74..         MOV     A,#(CardNo >> 8) & 0xff
   \   00001B   12....       LCALL   ??Subroutine24_0 & 0xFFFF
    561            }
   \                     ??CrossCallReturnLabel_44:
   \   00001E   C0E0         PUSH    A
   \   000020   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_11:
   \   000023   D0E0         POP     A
   \   000025   F0           MOVX    @DPTR,A
   \   000026   0A           INC     R2
   \   000027   EA           MOV     A,R2
   \   000028   C3           CLR     C
   \   000029   9405         SUBB    A,#0x5
   \   00002B   40E3         JC      ??Select_Card_0
    562            WriteReg(ChannelRedundancy, 0x0f);//Ñ¡ÔñÊý¾ÝÐ£ÑéµÄÖÖÀàºÍÄ£Ê½	
   \   00002D                ; Setup parameters for call to function WriteReg
   \   00002D   7A0F         MOV     R2,#0xf
   \   00002F   12....       LCALL   ??Subroutine19_0 & 0xFFFF
    563            temp = Command_Send(7, RevBuffer, Transceive);//Transceive=1EH£¨½ÓÊÕÃüÁî£©
    564            if(temp == FALSE)			
   \                     ??CrossCallReturnLabel_20:
   \   000032   7907         MOV     R1,#0x7
   \   000034   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_41:
   \   000037   7004         JNZ     ??Select_Card_1
    565            {
    566              return(1);
   \   000039   7901         MOV     R1,#0x1
   \   00003B   8026         SJMP    ??Select_Card_2
    567            }
    568            else
    569            {
    570              Fifo_Read(RevBuffer);	/* ´ÓFIFOÖÐ¶ÁÈ¡Ó¦´ðÐÅÏ¢, ¶ÁÈ¡¿¨Æ¬ÈÝÁ¿*/
   \                     ??Select_Card_1:
   \   00003D                ; Setup parameters for call to function Fifo_Read
   \   00003D   7A..         MOV     R2,#RevBuffer & 0xff
   \   00003F   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   000041   12....       LCALL   ??Fifo_Read?relay
    571              temp = *RevBuffer;			//·µ»Ø¿¨Æ¬ÈÝÁ¿S50¿¨:08,S70¿¨:18
   \   000044   90....       MOV     DPTR,#RevBuffer
   \   000047   E0           MOVX    A,@DPTR
   \   000048   F8           MOV     R0,A
    572              if((temp == 0x18) || (temp == 0x08) || (temp == 0x28) || (temp == 0x53))	/* ÅÐ¶ÏÓ¦´ðÐÅºÅÊÇ·ñÕýÈ· */
   \   000049   7418         MOV     A,#0x18
   \   00004B   68           XRL     A,R0
   \   00004C   600F         JZ      ??Select_Card_3
   \   00004E   7408         MOV     A,#0x8
   \   000050   68           XRL     A,R0
   \   000051   600A         JZ      ??Select_Card_3
   \   000053   7428         MOV     A,#0x28
   \   000055   68           XRL     A,R0
   \   000056   6005         JZ      ??Select_Card_3
   \   000058   7453         MOV     A,#0x53
   \   00005A   68           XRL     A,R0
   \   00005B   7004         JNZ     ??Select_Card_4
    573                return(0);
   \                     ??Select_Card_3:
   \   00005D   7900         MOV     R1,#0x0
   \   00005F   8002         SJMP    ??Select_Card_2
    574              else
    575                return(FM1702_SELERR);
   \                     ??Select_Card_4:
   \   000061   7916         MOV     R1,#0x16
    576            }
   \                     ??Select_Card_2:
   \   000063   02....       LJMP    ?Subroutine2 & 0xFFFF
    577          }
    578          
    579          /****************************************************************/
    580          /*Ãû³Æ: Check_UID */
    581          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖ¶ÔÊÕµ½µÄ¿¨Æ¬µÄÐòÁÐºÅµÄÅÐ¶Ï*/
    582          /*ÊäÈë: N/A */
    583          /*Êä³ö: TRUE: ÐòÁÐºÅÕýÈ·*/
    584          /* FALSE: ÐòÁÐºÅ´íÎó*/
    585          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    586          uint8 Check_UID(void)
   \                     Check_UID:
    587          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
    588            uint8 temp;
    589            uint8 i;
    590            temp = 0x00;
   \   000005   75..00       MOV     ?V0 + 2,#0x0
    591            for(i = 0; i < 5; i++)
   \   000008   7800         MOV     R0,#0x0
    592            {
    593              temp = temp ^ CardNo[i];//¶Ô¿¨ºÅÒì»òÔËËã£¬¼´¶þÊýÏàÍ¬Îª0£¬²»Í¬Îª1
   \                     ??Check_UID_0:
   \   00000A   88..         MOV     ?V0 + 0,R0
   \   00000C   74..         MOV     A,#CardNo & 0xff
   \   00000E   25..         ADD     A,?V0 + 0
   \   000010   F582         MOV     DPL,A
   \   000012   74..         MOV     A,#(CardNo >> 8) & 0xff
   \   000014   12....       LCALL   ??Subroutine24_0 & 0xFFFF
    594            }						//ÕýÈ·½á¹ûÎª0
   \                     ??CrossCallReturnLabel_45:
   \   000017   62..         XRL     ?V0 + 2,A
   \   000019   08           INC     R0
   \   00001A   E8           MOV     A,R0
   \   00001B   C3           CLR     C
   \   00001C   9405         SUBB    A,#0x5
   \   00001E   40EA         JC      ??Check_UID_0
    595            if(temp == 0)
   \   000020   E5..         MOV     A,?V0 + 2
   \   000022   7004         JNZ     ??Check_UID_1
    596            {
    597              return TRUE;
   \   000024   7901         MOV     R1,#0x1
   \   000026   8002         SJMP    ??Check_UID_2
    598            }
    599            return FALSE;
   \                     ??Check_UID_1:
   \   000028   7900         MOV     R1,#0x0
   \                     ??Check_UID_2:
   \   00002A                REQUIRE ?Subroutine4
   \   00002A                ; // Fall through to label ?Subroutine4
    600          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   7F03         MOV     R7,#0x3
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    601          
    602          /****************************************************************/
    603          /*Ãû³Æ: AntiColl */
    604          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖ¶Ô·ÅÈëFM1702²Ù×÷·¶Î§Ö®ÄÚµÄ¿¨Æ¬µÄ·À³åÍ»¼ì²â*/
    605          /*ÊäÈë: N/A */
    606          /*Êä³ö: FM1702_NOTAGERR: ÎÞ¿¨*/
    607          /* FM1702_BYTECOUNTERR: ½ÓÊÕ×Ö½Ú´íÎó*/
    608          /* FM1702_SERNRERR: ¿¨Æ¬ÐòÁÐºÅÓ¦´ð´íÎó*/
    609          /* FM1702_OK: ¿¨Æ¬Ó¦´ðÕýÈ·*/
    610          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   7902         MOV     R1,#0x2
   \   000002                REQUIRE ??Subroutine22_0
   \   000002                ; // Fall through to label ??Subroutine22_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    611          uint8 AntiColl(void)
   \                     AntiColl:
    612          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    613            uint8	temp;
    614            uint8	i;
    615            RevBuffer[0] = RF_CMD_ANTICOL;    //Ð´Ñ°¿¨Í¨Ñ¶ÃüÁî93H
   \   000005   90....       MOV     DPTR,#RevBuffer
   \   000008   7493         MOV     A,#-0x6d
   \   00000A   F0           MOVX    @DPTR,A
    616            RevBuffer[1] = 0x20;              //Ð´Ñ°¿¨Í¨Ñ¶ÃüÁî20H
   \   00000B   A3           INC     DPTR
   \   00000C   7420         MOV     A,#0x20
   \   00000E   F0           MOVX    @DPTR,A
    617            WriteReg(ChannelRedundancy, 0x03); //address 22H  Ñ¡ÔñÊý¾ÝÐ£ÑéÖÖÀàºÍÀàÐÍ
   \   00000F                ; Setup parameters for call to function WriteReg
   \   00000F   12....       LCALL   ?Subroutine5 & 0xFFFF
    618            temp = Command_Send(2, RevBuffer, Transceive);//Transceive=0X1EÃüÁî
    619            while(1)
    620            {
    621              if(temp == FALSE)
   \                     ??CrossCallReturnLabel_19:
   \   000012   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_34:
   \   000015   7004         JNZ     ??AntiColl_0
    622              {
    623                return(1);   //ÎÞ¿¨
   \   000017   7901         MOV     R1,#0x1
   \   000019   8043         SJMP    ??AntiColl_1
    624              }	  
    625              temp = ReadReg(FIFOLength);   //¶Á0x04ÀïµÄ·µ»Ø¿¨ºÅ³¤¶È
   \                     ??AntiColl_0:
   \   00001B                ; Setup parameters for call to function ReadReg
   \   00001B   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_23:
   \   00001E   FE           MOV     R6,A
    626              if(temp == 0)
   \   00001F   7004         JNZ     ??AntiColl_2
    627              {
    628                return FM1702_BYTECOUNTERR; //½ÓÊÕ×Ö½Ú³¤¶È´íÎó
   \   000021   790C         MOV     R1,#0xc
   \   000023   8039         SJMP    ??AntiColl_1
    629              }
    630              Fifo_Read(RevBuffer);           //¶ÁÈ¡¿¨ºÅ  					
   \                     ??AntiColl_2:
   \   000025                ; Setup parameters for call to function Fifo_Read
   \   000025   7A..         MOV     R2,#RevBuffer & 0xff
   \   000027   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   000029   12....       LCALL   ??Fifo_Read?relay
    631              for(i = 0; i < temp; i++)
   \   00002C   7A00         MOV     R2,#0x0
    632              {
    633                CardNo[i] = RevBuffer[i]; //°ÑÁÙÊ±¼Ä´æÆ÷ÖÐµÄ¿¨ºÅ·ÅÔÚUID×¨ÓÃ¼Ä´æÆ÷ÖÐ
   \                     ??AntiColl_3:
   \   00002E   8A82         MOV     DPL,R2
   \   000030   A882         MOV     R0,DPL
   \   000032   74..         MOV     A,#RevBuffer & 0xff
   \   000034   28           ADD     A,R0
   \   000035   F582         MOV     DPL,A
   \   000037   74..         MOV     A,#(RevBuffer >> 8) & 0xff
   \   000039   12....       LCALL   ??Subroutine24_0 & 0xFFFF
    634              }		
   \                     ??CrossCallReturnLabel_46:
   \   00003C   C0E0         PUSH    A
   \   00003E   74..         MOV     A,#CardNo & 0xff
   \   000040   28           ADD     A,R0
   \   000041   F582         MOV     DPL,A
   \   000043   74..         MOV     A,#(CardNo >> 8) & 0xff
   \   000045   3400         ADDC    A,#0x0
   \   000047   F583         MOV     DPH,A
   \   000049   D0E0         POP     A
   \   00004B   F0           MOVX    @DPTR,A
   \   00004C   0A           INC     R2
   \   00004D   EA           MOV     A,R2
   \   00004E   C3           CLR     C
   \   00004F   9E           SUBB    A,R6
   \   000050   40DC         JC      ??AntiColl_3
    635              temp = Check_UID();			/* Ð£ÑéÊÕµ½µÄUID */
    636              if(temp == FALSE)
   \   000052                ; Setup parameters for call to function Check_UID
   \   000052   12....       LCALL   ??Check_UID?relay
   \   000055   E9           MOV     A,R1
   \   000056   7004         JNZ     ??AntiColl_4
    637              {
    638                return(FM1702_SERNRERR);
   \   000058   7908         MOV     R1,#0x8
   \   00005A   8002         SJMP    ??AntiColl_1
    639              }
    640              return(0);
   \                     ??AntiColl_4:
   \   00005C   7900         MOV     R1,#0x0
    641            }
   \                     ??AntiColl_1:
   \   00005E   02....       LJMP    ??Subroutine21_0 & 0xFFFF
    642          }
    643          
    644          /****************************************************************/
    645          /*Ãû³Æ: MIF_Read */
    646          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖ¶ÁMIFARE¿¨¿éµÄÊýÖµ*/
    647          /*ÊäÈë: buff: »º³åÇøÊ×µØÖ·*/
    648          /* Block_Adr: ¿éµØÖ·*/
    649          /*Êä³ö: FM1702_NOTAGERR: ÎÞ¿¨*/
    650          /* FM1702_PARITYERR: ÆæÅ¼Ð£Ñé´í*/
    651          /* FM1702_CRCERR: CRCÐ£Ñé´í*/
    652          /* FM1702_BYTECOUNTERR: ½ÓÊÕ×Ö½Ú´íÎó*/
    653          /* FM1702_OK: Ó¦´ðÕýÈ·*/
    654          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    655          uint8 MIF_READ(uint8 *buff, uint8 Block_Adr)
   \                     MIF_READ:
    656          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   89..         MOV     ?V0 + 0,R1
    657          	uint8 temp;
    658          	WriteReg(0x22,0x0f);
   \   00000B                ; Setup parameters for call to function WriteReg
   \   00000B   7A0F         MOV     R2,#0xf
   \   00000D   7922         MOV     R1,#0x22
   \   00000F   12....       LCALL   ??WriteReg?relay
    659          	buff[0] = RF_CMD_READ;   //0x30
   \   000012   8E82         MOV     DPL,R6
   \   000014   8F83         MOV     DPH,R7
   \   000016   7430         MOV     A,#0x30
   \   000018   F0           MOVX    @DPTR,A
    660          	buff[1] = Block_Adr;
   \   000019   A3           INC     DPTR
   \   00001A   E5..         MOV     A,?V0 + 0
   \   00001C   F0           MOVX    @DPTR,A
    661          	temp = Command_Send(2, buff, Transceive);
    662          	if(temp == 0)
   \   00001D                ; Setup parameters for call to function Command_Send
   \   00001D   7C1E         MOV     R4,#0x1e
   \   00001F   EE           MOV     A,R6
   \   000020   FA           MOV     R2,A
   \   000021   EF           MOV     A,R7
   \   000022   FB           MOV     R3,A
   \   000023   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_35:
   \   000026   7004         JNZ     ??MIF_READ_0
    663          	{			
    664          	  return (1);  //´íÎó
   \                     ??MIF_READ_1:
   \   000028   7901         MOV     R1,#0x1
   \   00002A   8010         SJMP    ??MIF_READ_2
    665          	}
    666          
    667          	temp = ReadReg(0x04);
    668          	if(temp == 0x10)	
   \                     ??MIF_READ_0:
   \   00002C                ; Setup parameters for call to function ReadReg
   \   00002C   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   00002F   6410         XRL     A,#0x10
   \   000031   70F5         JNZ     ??MIF_READ_1
    669          	{
    670          	  Fifo_Read(buff);
   \   000033                ; Setup parameters for call to function Fifo_Read
   \   000033   EE           MOV     A,R6
   \   000034   FA           MOV     R2,A
   \   000035   EF           MOV     A,R7
   \   000036   FB           MOV     R3,A
   \   000037   12....       LCALL   ??Fifo_Read?relay
    671          	  return (0); //ÕýÈ·
   \   00003A   7900         MOV     R1,#0x0
    672          	}
   \                     ??MIF_READ_2:
   \   00003C   02....       LJMP    ??Subroutine21_0 & 0xFFFF
    673          	return (1);
    674          }
    675          
    676          /****************************************************************/
    677          /*Ãû³Æ: MIF_Write */
    678          /*¹¦ÄÜ: ¸Ãº¯ÊýÊµÏÖÐ´MIFARE¿¨¿éµÄÊýÖµ*/
    679          /*ÊäÈë: buff: »º³åÇøÊ×µØÖ·*/
    680          /* Block_Adr: ¿éµØÖ·*/
    681          /*Êä³ö: FM1702_NOTAGERR: ÎÞ¿¨*/
    682          /* FM1702_BYTECOUNTERR: ½ÓÊÕ×Ö½Ú´íÎó*/
    683          /* FM1702_NOTAUTHERR: Î´¾­È¨ÍþÈÏÖ¤*/
    684          /* FM1702_EMPTY: Êý¾ÝÒç³ö´íÎó*/
    685          /* FM1702_CRCERR: CRCÐ£Ñé´í*/
    686          /* FM1702_PARITYERR: ÆæÅ¼Ð£Ñé´í*/
    687          /* FM1702_WRITEERR: Ð´¿¨¿éÊý¾Ý³ö´í*/
    688          /* FM1702_OK: Ó¦´ðÕýÈ·*/
    689          /****************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    690          uint8 MIF_Write(uint8 *buff, uint8 Block_Adr)
   \                     MIF_Write:
    691          {
   \   000000   74F5         MOV     A,#-0xb
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 11
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
   \   000009   89..         MOV     ?V0 + 2,R1
    692          	uint8	temp;
    693          	uint8	*F_buff;
    694          
    695          	WriteReg(0x23,0x63);
   \   00000B                ; Setup parameters for call to function WriteReg
   \   00000B   7A63         MOV     R2,#0x63
   \   00000D   7923         MOV     R1,#0x23
   \   00000F   12....       LCALL   ??WriteReg?relay
    696          	WriteReg(0x12,0x3f);
   \   000012                ; Setup parameters for call to function WriteReg
   \   000012   7A3F         MOV     R2,#0x3f
   \   000014   7912         MOV     R1,#0x12
   \   000016   12....       LCALL   ??WriteReg?relay
    697          	F_buff = buff + 0x10;
   \   000019   EE           MOV     A,R6
   \   00001A   2410         ADD     A,#0x10
   \   00001C   F5..         MOV     ?V0 + 0,A
   \   00001E   EF           MOV     A,R7
   \   00001F   3400         ADDC    A,#0x0
   \   000021   F5..         MOV     ?V0 + 1,A
    698          	WriteReg(0x22,0x07);    /* Note: this line is for 1702, different from RC500*/
   \   000023                ; Setup parameters for call to function WriteReg
   \   000023   7A07         MOV     R2,#0x7
   \   000025   7922         MOV     R1,#0x22
   \   000027   12....       LCALL   ??WriteReg?relay
    699          	*F_buff = RF_CMD_WRITE;
   \   00002A   85..82       MOV     DPL,?V0 + 0
   \   00002D   85..83       MOV     DPH,?V0 + 1
   \   000030   74A0         MOV     A,#-0x60
   \   000032   F0           MOVX    @DPTR,A
    700          	*(F_buff + 1) = Block_Adr;
   \   000033   A3           INC     DPTR
   \   000034   E5..         MOV     A,?V0 + 2
   \   000036   F0           MOVX    @DPTR,A
    701          	temp = Command_Send(2, F_buff, Transceive);
    702          	if(temp == FALSE)
   \   000037                ; Setup parameters for call to function Command_Send
   \   000037   7C1E         MOV     R4,#0x1e
   \   000039   AA..         MOV     R2,?V0 + 0
   \   00003B   AB..         MOV     R3,?V0 + 1
   \   00003D   12....       LCALL   ?Subroutine13 & 0xFFFF
   \                     ??CrossCallReturnLabel_36:
   \   000040   7005         JNZ     ??MIF_Write_0
    703          	{
    704          		return(1);
   \   000042   7901         MOV     R1,#0x1
    705          	}
   \                     ??MIF_Write_1:
   \   000044   02....       LJMP    ?Subroutine4 & 0xFFFF
    706          
    707          	temp = ReadReg(0x04);
    708          	if(temp == 0)
   \                     ??MIF_Write_0:
   \   000047                ; Setup parameters for call to function ReadReg
   \   000047   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   00004A   7004         JNZ     ??MIF_Write_2
    709          	{
    710          		return(FM1702_BYTECOUNTERR);
   \   00004C   790C         MOV     R1,#0xc
   \   00004E   80F4         SJMP    ??MIF_Write_1
    711          	}
    712          
    713          	Fifo_Read(F_buff);
   \                     ??MIF_Write_2:
   \   000050                ; Setup parameters for call to function Fifo_Read
   \   000050   AA..         MOV     R2,?V0 + 0
   \   000052   AB..         MOV     R3,?V0 + 1
   \   000054   12....       LCALL   ??Fifo_Read?relay
    714          	temp = *F_buff;
    715          	switch(temp)
   \   000057   85..82       MOV     DPL,?V0 + 0
   \   00005A   85..83       MOV     DPH,?V0 + 1
   \   00005D   E0           MOVX    A,@DPTR
   \   00005E   6010         JZ      ??MIF_Write_3
   \   000060   14           DEC     A
   \   000061   6028         JZ      ??MIF_Write_4
   \   000063   24FD         ADD     A,#-0x3
   \   000065   600D         JZ      ??MIF_Write_5
   \   000067   14           DEC     A
   \   000068   6025         JZ      ??MIF_Write_6
   \   00006A   24FB         ADD     A,#-0x5
   \   00006C   600A         JZ      ??MIF_Write_7
   \   00006E   8038         SJMP    ??MIF_Write_8
    716          	{
    717          	case 0x00:	return(FM1702_NOTAUTHERR);	
   \                     ??MIF_Write_3:
   \   000070   790A         MOV     R1,#0xa
   \   000072   80D0         SJMP    ??MIF_Write_1
    718          	case 0x04:	return(FM1702_EMPTY);
   \                     ??MIF_Write_5:
   \   000074   7903         MOV     R1,#0x3
   \   000076   80CC         SJMP    ??MIF_Write_1
    719          	case 0x0a:	break;
    720          	case 0x01:	return(FM1702_CRCERR);
    721          	case 0x05:	return(FM1702_PARITYERR);
    722          	default:	return(FM1702_WRITEERR);
    723          	}
    724          
    725          	temp = Command_Send(16, buff, Transceive);
    726          	if(temp == TRUE)
   \                     ??MIF_Write_7:
   \   000078                ; Setup parameters for call to function Command_Send
   \   000078   7C1E         MOV     R4,#0x1e
   \   00007A   EE           MOV     A,R6
   \   00007B   FA           MOV     R2,A
   \   00007C   EF           MOV     A,R7
   \   00007D   FB           MOV     R3,A
   \   00007E   7910         MOV     R1,#0x10
   \   000080   12....       LCALL   ??Subroutine22_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   000083   6401         XRL     A,#0x1
   \   000085   700C         JNZ     ??MIF_Write_9
    727          	{
    728          		return(0);
   \   000087   7900         MOV     R1,#0x0
   \   000089   80B9         SJMP    ??MIF_Write_1
    729          	}
   \                     ??MIF_Write_4:
   \   00008B   7902         MOV     R1,#0x2
   \   00008D   80B5         SJMP    ??MIF_Write_1
   \                     ??MIF_Write_6:
   \   00008F   7905         MOV     R1,#0x5
   \   000091   80B1         SJMP    ??MIF_Write_1
    730          	else
    731          	{
    732          		temp = ReadReg(0x0a);
   \                     ??MIF_Write_9:
   \   000093                ; Setup parameters for call to function ReadReg
   \   000093   790A         MOV     R1,#0xa
   \   000095   12....       LCALL   ??Subroutine20_0 & 0xFFFF
    733          		if((temp & 0x02) == 0x02)
   \                     ??CrossCallReturnLabel_33:
   \   000098   A2E1         MOV     C,0xE0 /* A   */.1
   \   00009A   40F3         JC      ??MIF_Write_6
    734          			return(FM1702_PARITYERR);
    735          		else if((temp & 0x04) == 0x04)
   \   00009C   A2E2         MOV     C,0xE0 /* A   */.2
   \   00009E   5004         JNC     ??MIF_Write_10
    736          			return(FM1702_FRAMINGERR);
   \   0000A0   7914         MOV     R1,#0x14
   \   0000A2   80A0         SJMP    ??MIF_Write_1
    737          		else if((temp & 0x08) == 0x08)
   \                     ??MIF_Write_10:
   \   0000A4   A2E3         MOV     C,0xE0 /* A   */.3
   \   0000A6   40E3         JC      ??MIF_Write_4
    738          			return(FM1702_CRCERR);
    739          		else
    740          			return(FM1702_WRITEERR);
    741          	}
   \                     ??MIF_Write_8:
   \   0000A8   790F         MOV     R1,#0xf
   \   0000AA   8098         SJMP    ??MIF_Write_1
    742          }
    743          
    744          /*********************************************************************
    745           * @fn      SerialApp_Init
    746           *
    747           * @brief   This is called during OSAL tasks' initialization.
    748           *
    749           * @param   task_id - the Task ID assigned by OSAL.
    750           *
    751           * @return  none
    752           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    753          void SerialApp_Init( uint8 task_id )
   \                     SerialApp_Init:
    754          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    755            halUARTCfg_t uartConfig;
    756            SerialApp_TaskID = task_id;
   \   00000C   90....       MOV     DPTR,#SerialApp_TaskID
   \   00000F   F0           MOVX    @DPTR,A
    757            afRegister( (endPointDesc_t *)&SerialApp_epDesc );
   \   000010                ; Setup parameters for call to function afRegister
   \   000010   7A..         MOV     R2,#SerialApp_epDesc & 0xff
   \   000012   7B..         MOV     R3,#(SerialApp_epDesc >> 8) & 0xff
   \   000014   12....       LCALL   ??afRegister?relay
    758            RegisterForKeys( task_id );
   \   000017                ; Setup parameters for call to function RegisterForKeys
   \   000017   EE           MOV     A,R6
   \   000018   F9           MOV     R1,A
   \   000019   12....       LCALL   ??RegisterForKeys?relay
    759            HalUARTInitSPI();
   \   00001C                ; Setup parameters for call to function HalUARTInitSPI
   \   00001C   12....       LCALL   ??HalUARTInitSPI?relay
    760            GPIOInit();
   \   00001F   43FE04       ORL     0xfe,#0x4
   \   000022   43FD01       ORL     0xfd,#0x1
   \   000025   C280         CLR     0x80.0
    761            InitFM1702SL();
   \   000027                ; Setup parameters for call to function InitFM1702SL
   \   000027   12....       LCALL   ??InitFM1702SL?relay
    762           
    763            uartConfig.configured           = TRUE;              // 2x30 don't care - see uart driver.
   \   00002A   85..82       MOV     DPL,?XSP + 0
   \   00002D   85..83       MOV     DPH,?XSP + 1
   \   000030   7401         MOV     A,#0x1
   \   000032   F0           MOVX    @DPTR,A
    764            uartConfig.baudRate             = SERIAL_APP_BAUD;
   \   000033   12....       LCALL   ?XSTACK_DISP0_8
   \   000036   7401         MOV     A,#0x1
   \   000038   F0           MOVX    @DPTR,A
    765            uartConfig.flowControl          = FALSE;
   \   000039   04           INC     A
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   E4           CLR     A
   \   00003E   F0           MOVX    @DPTR,A
    766            uartConfig.flowControlThreshold = SERIAL_APP_THRESH; // 2x30 don't care - see uart driver.
   \   00003F   7403         MOV     A,#0x3
   \   000041   12....       LCALL   ?XSTACK_DISP0_8
   \   000044   7440         MOV     A,#0x40
   \   000046   F0           MOVX    @DPTR,A
   \   000047   A3           INC     DPTR
   \   000048   E4           CLR     A
   \   000049   F0           MOVX    @DPTR,A
    767            uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;  // 2x30 don't care - see uart driver.
   \   00004A   740A         MOV     A,#0xa
   \   00004C   12....       LCALL   ?XSTACK_DISP0_8
   \   00004F   7480         MOV     A,#-0x80
   \   000051   F0           MOVX    @DPTR,A
   \   000052   A3           INC     DPTR
   \   000053   E4           CLR     A
   \   000054   F0           MOVX    @DPTR,A
    768            uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;  // 2x30 don't care - see uart driver.
   \   000055   7412         MOV     A,#0x12
   \   000057   12....       LCALL   ?XSTACK_DISP0_8
   \   00005A   7480         MOV     A,#-0x80
   \   00005C   F0           MOVX    @DPTR,A
   \   00005D   A3           INC     DPTR
   \   00005E   E4           CLR     A
   \   00005F   F0           MOVX    @DPTR,A
    769            uartConfig.idleTimeout          = SERIAL_APP_IDLE;   // 2x30 don't care - see uart driver.
   \   000060   7405         MOV     A,#0x5
   \   000062   12....       LCALL   ?XSTACK_DISP0_8
   \   000065   7406         MOV     A,#0x6
   \   000067   F0           MOVX    @DPTR,A
    770            uartConfig.intEnable            = TRUE;              // 2x30 don't care - see uart driver.
   \   000068   7416         MOV     A,#0x16
   \   00006A   12....       LCALL   ?XSTACK_DISP0_8
   \   00006D   7401         MOV     A,#0x1
   \   00006F   F0           MOVX    @DPTR,A
    771            uartConfig.callBackFunc         = SerialApp_CallBack;
   \   000070   741B         MOV     A,#0x1b
   \   000072   12....       LCALL   ?XSTACK_DISP0_8
   \   000075   74..         MOV     A,#??SerialApp_CallBack?relay & 0xff
   \   000077   F0           MOVX    @DPTR,A
   \   000078   A3           INC     DPTR
   \   000079   74..         MOV     A,#(??SerialApp_CallBack?relay >> 8) & 0xff
   \   00007B   F0           MOVX    @DPTR,A
    772            HalUARTOpen (SERIAL_APP_PORT, &uartConfig);
   \   00007C                ; Setup parameters for call to function HalUARTOpen
   \   00007C   85..82       MOV     DPL,?XSP + 0
   \   00007F   85..83       MOV     DPH,?XSP + 1
   \   000082   AA82         MOV     R2,DPL
   \   000084   AB83         MOV     R3,DPH
   \   000086   7900         MOV     R1,#0x0
   \   000088   12....       LCALL   ??HalUARTOpen?relay
    773            
    774            UART0_Format.Header_1 = 0xee;
   \   00008B   90....       MOV     DPTR,#UART0_Format
   \   00008E   12....       LCALL   ?Subroutine12 & 0xFFFF
    775            UART0_Format.Header_2 = 0xcc;
    776            UART0_Format.NodeSeq  = 0x01;
    777            UART0_Format.NodeID   = RFID_1356;
    778            UART0_Format.Tailer   = 0xff;
   \                     ??CrossCallReturnLabel_6:
   \   000091   90....       MOV     DPTR,#UART0_Format + 15
   \   000094   74FF         MOV     A,#-0x1
   \   000096   F0           MOVX    @DPTR,A
    779            
    780            SerialApp_TxAddr.addrMode =(afAddrMode_t)Addr16Bit;//·¢ËÍµØÖ·³õÊ¼»¯
   \   000097   90....       MOV     DPTR,#SerialApp_TxAddr + 8
   \   00009A   7402         MOV     A,#0x2
   \   00009C   F0           MOVX    @DPTR,A
    781            SerialApp_TxAddr.endPoint = SERIALAPP_ENDPOINT;
   \   00009D   A3           INC     DPTR
   \   00009E   740B         MOV     A,#0xb
   \   0000A0   F0           MOVX    @DPTR,A
    782            SerialApp_TxAddr.addr.shortAddr = 0x0000;
   \   0000A1   90....       MOV     DPTR,#SerialApp_TxAddr
   \   0000A4   E4           CLR     A
   \   0000A5   F0           MOVX    @DPTR,A
   \   0000A6   A3           INC     DPTR
   \   0000A7   F0           MOVX    @DPTR,A
    783            TXPOWER = 0xf5;
   \   0000A8   906190       MOV     DPTR,#0x6190
   \   0000AB   74F5         MOV     A,#-0xb
   \   0000AD   F0           MOVX    @DPTR,A
    784          }
   \   0000AE   741D         MOV     A,#0x1d
   \   0000B0   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B3   02....       LJMP    ??Subroutine21_0 & 0xFFFF
   \   0000B6                REQUIRE P1DIR
   \   0000B6                REQUIRE P0DIR
   \   0000B6                REQUIRE _A_P0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   74EE         MOV     A,#-0x12
   \   000002   F0           MOVX    @DPTR,A
   \   000003   A3           INC     DPTR
   \   000004   74CC         MOV     A,#-0x34
   \   000006   F0           MOVX    @DPTR,A
   \   000007   A3           INC     DPTR
   \   000008   7401         MOV     A,#0x1
   \   00000A   F0           MOVX    @DPTR,A
   \   00000B   A3           INC     DPTR
   \   00000C   7410         MOV     A,#0x10
   \   00000E   F0           MOVX    @DPTR,A
   \   00000F   22           RET
    785          
    786          /*********************************************************************
    787           * @fn      SerialApp_ProcessEvent
    788           *
    789           * @brief   Generic Application Task event processor.
    790           *
    791           * @param   task_id  - The OSAL assigned task ID.
    792           * @param   events   - Bit map of events to process.
    793           *
    794           * @return  Event flags of all unprocessed events.
    795           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    796          UINT16 SerialApp_ProcessEvent( uint8 task_id, UINT16 events )
   \                     SerialApp_ProcessEvent:
    797          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    798            (void)task_id;  // Intentionally unreferenced parameter
    799            
    800            if ( events & SYS_EVENT_MSG )
   \   000009   5480         ANL     A,#0x80
   \   00000B   707D         JNZ     ??SerialApp_ProcessEvent_0
    801            {
    802              afIncomingMSGPacket_t *MSGpkt;
    803          
    804              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SerialApp_TaskID )) )
    805              {
    806                switch ( MSGpkt->hdr.event )
    807                {         
    808                case KEY_CHANGE:
    809                  //SerialApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    810                  break;
    811          
    812                case AF_INCOMING_MSG_CMD:
    813                  SerialApp_ProcessMSGCmd( MSGpkt );
    814                  break;
    815          
    816                case ZDO_STATE_CHANGE:
    817                    SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    818                    if(SampleApp_NwkState == DEV_END_DEVICE) //ÅÐ¶¨µ±Ç°Éè±¸ÀàÐÍ
    819                    {
    820                      HalLedSet(HAL_LED_1,HAL_LED_MODE_ON);
    821                      HalLedBlink(HAL_LED_2,5,50,500);
    822                      osal_set_event(SerialApp_TaskID, PERIOD_EVT); //Æô¶¯ÖÜÆÚÏûÏ¢
    823                      osal_set_event(SerialApp_TaskID, RFID_EVT);
    824                    }
    825                  break;
    826                default:
    827                  break;
    828                }
    829          
    830                osal_msg_deallocate( (uint8 *)MSGpkt );
    831              }
    832          
    833              return ( events ^ SYS_EVENT_MSG );
    834            }
    835            
    836            if ( events & PERIOD_EVT ) //ÖÜÆÚÏûÏ¢´¦Àí
   \   00000D   EE           MOV     A,R6
   \   00000E   5402         ANL     A,#0x2
   \   000010   7003         JNZ     $+5
   \   000012   02....       LJMP    ??SerialApp_ProcessEvent_1 & 0xFFFF
    837            {
    838              UART0_Format.Command = MSG_PERIOD;
   \   000015   90....       MOV     DPTR,#UART0_Format + 4
   \   000018   74AA         MOV     A,#-0x56
   \   00001A   F0           MOVX    @DPTR,A
    839              UART0_Format.Data[0] = 0x00;
   \   00001B   A3           INC     DPTR
   \   00001C   E4           CLR     A
   \   00001D   F0           MOVX    @DPTR,A
    840              UART0_Format.Data[1] = 0x00; 
   \   00001E   A3           INC     DPTR
   \   00001F   F0           MOVX    @DPTR,A
    841              UART0_Format.Data[2] = 0x00;
   \   000020   A3           INC     DPTR
   \   000021   F0           MOVX    @DPTR,A
    842              UART0_Format.Data[3] = 0x00; 
   \   000022   A3           INC     DPTR
   \   000023   F0           MOVX    @DPTR,A
    843              UART0_Format.Data[4] = 0x00;
   \   000024   A3           INC     DPTR
   \   000025   F0           MOVX    @DPTR,A
    844              UART0_Format.Data[5] = 0x00; 
   \   000026   A3           INC     DPTR
   \   000027   F0           MOVX    @DPTR,A
    845              SerialApp_OTAData(&SerialApp_TxAddr, SERIALAPP_CLUSTERID1, &UART0_Format, sizeof(UART_Format));
   \   000028                ; Setup parameters for call to function SerialApp_OTAData
   \   000028   75..10       MOV     ?V0 + 0,#0x10
   \   00002B   78..         MOV     R0,#?V0 + 0
   \   00002D   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000030   7C..         MOV     R4,#UART0_Format & 0xff
   \   000032   7D..         MOV     R5,#(UART0_Format >> 8) & 0xff
   \   000034   7901         MOV     R1,#0x1
   \   000036   7A..         MOV     R2,#SerialApp_TxAddr & 0xff
   \   000038   7B..         MOV     R3,#(SerialApp_TxAddr >> 8) & 0xff
   \   00003A   12....       LCALL   ??SerialApp_OTAData?relay
   \   00003D   7401         MOV     A,#0x1
   \   00003F   12....       LCALL   ?DEALLOC_XSTACK8
    846              osal_start_timerEx(SerialApp_TaskID, PERIOD_EVT, 5000);
   \   000042                ; Setup parameters for call to function osal_start_timerEx
   \   000042   7C88         MOV     R4,#-0x78
   \   000044   7D13         MOV     R5,#0x13
   \   000046   7A02         MOV     R2,#0x2
   \   000048   7B00         MOV     R3,#0x0
   \   00004A   90....       MOV     DPTR,#SerialApp_TaskID
   \   00004D   E0           MOVX    A,@DPTR
   \   00004E   F9           MOV     R1,A
   \   00004F   12....       LCALL   ??osal_start_timerEx?relay
    847              return ( events ^ PERIOD_EVT );
   \   000052   EE           MOV     A,R6
   \   000053   6402         XRL     A,#0x2
   \                     ??SerialApp_ProcessEvent_2:
   \   000055   FA           MOV     R2,A
   \   000056   EF           MOV     A,R7
   \                     ??SerialApp_ProcessEvent_3:
   \   000057   FB           MOV     R3,A
   \   000058   02....       LJMP    ??SerialApp_ProcessEvent_4 & 0xFFFF
    848            }
   \                     ??SerialApp_ProcessEvent_5:
   \   00005B   A3           INC     DPTR
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   90....       MOV     DPTR,#SampleApp_NwkState
   \   000060   F0           MOVX    @DPTR,A
   \   000061   6406         XRL     A,#0x6
   \   000063   701E         JNZ     ??CrossCallReturnLabel_53
   \   000065                ; Setup parameters for call to function HalLedSet
   \   000065   7A01         MOV     R2,#0x1
   \   000067   7901         MOV     R1,#0x1
   \   000069   12....       LCALL   ??HalLedSet?relay
   \   00006C                ; Setup parameters for call to function HalLedBlink
   \   00006C   7CF4         MOV     R4,#-0xc
   \   00006E   7D01         MOV     R5,#0x1
   \   000070   7B32         MOV     R3,#0x32
   \   000072   7A05         MOV     R2,#0x5
   \   000074   7902         MOV     R1,#0x2
   \   000076   12....       LCALL   ??HalLedBlink?relay
   \   000079                ; Setup parameters for call to function osal_set_event
   \   000079   7A02         MOV     R2,#0x2
   \   00007B   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_52:
   \   00007E                ; Setup parameters for call to function osal_set_event
   \   00007E   7A04         MOV     R2,#0x4
   \   000080   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_53:
   \   000083                ; Setup parameters for call to function osal_msg_deallocate
   \   000083   AA..         MOV     R2,?V0 + 0
   \   000085   AB..         MOV     R3,?V0 + 1
   \   000087   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??SerialApp_ProcessEvent_0:
   \   00008A                ; Setup parameters for call to function osal_msg_receive
   \   00008A   90....       MOV     DPTR,#SerialApp_TaskID
   \   00008D   E0           MOVX    A,@DPTR
   \   00008E   F9           MOV     R1,A
   \   00008F   12....       LCALL   ??osal_msg_receive?relay
   \   000092   8A..         MOV     ?V0 + 0,R2
   \   000094   8B..         MOV     ?V0 + 1,R3
   \   000096   EA           MOV     A,R2
   \   000097   45..         ORL     A,?V0 + 1
   \   000099   6014         JZ      ??SerialApp_ProcessEvent_6
   \   00009B   8A82         MOV     DPL,R2
   \   00009D   8B83         MOV     DPH,R3
   \   00009F   E0           MOVX    A,@DPTR
   \   0000A0   24E6         ADD     A,#-0x1a
   \   0000A2   6006         JZ      ??SerialApp_ProcessEvent_7
   \   0000A4   2449         ADD     A,#0x49
   \   0000A6   60B3         JZ      ??SerialApp_ProcessEvent_5
   \   0000A8   80D9         SJMP    ??CrossCallReturnLabel_53
   \                     ??SerialApp_ProcessEvent_7:
   \   0000AA                ; Setup parameters for call to function SerialApp_ProcessMSGCmd
   \   0000AA   12....       LCALL   ??SerialApp_ProcessMSGCmd?relay
   \   0000AD   80D4         SJMP    ??CrossCallReturnLabel_53
   \                     ??SerialApp_ProcessEvent_6:
   \   0000AF   EE           MOV     A,R6
   \   0000B0   FA           MOV     R2,A
   \   0000B1   EF           MOV     A,R7
   \   0000B2   6480         XRL     A,#0x80
   \   0000B4   80A1         SJMP    ??SerialApp_ProcessEvent_3
    849            
    850            if ( events & SERIALAPP_SEND_EVT ) //·¢ËÍRFÏûÏ¢
   \                     ??SerialApp_ProcessEvent_1:
   \   0000B6   EE           MOV     A,R6
   \   0000B7   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000B9   5020         JNC     ??SerialApp_ProcessEvent_8
    851            {
    852              SerialApp_OTAData(&SerialApp_TxAddr,SERIALAPP_CLUSTERID1, &UART0_Format, sizeof(UART_Format));
   \   0000BB                ; Setup parameters for call to function SerialApp_OTAData
   \   0000BB   75..10       MOV     ?V0 + 0,#0x10
   \   0000BE   78..         MOV     R0,#?V0 + 0
   \   0000C0   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000C3   7C..         MOV     R4,#UART0_Format & 0xff
   \   0000C5   7D..         MOV     R5,#(UART0_Format >> 8) & 0xff
   \   0000C7   7901         MOV     R1,#0x1
   \   0000C9   7A..         MOV     R2,#SerialApp_TxAddr & 0xff
   \   0000CB   7B..         MOV     R3,#(SerialApp_TxAddr >> 8) & 0xff
   \   0000CD   12....       LCALL   ??SerialApp_OTAData?relay
   \   0000D0   7401         MOV     A,#0x1
   \   0000D2   12....       LCALL   ?DEALLOC_XSTACK8
    853              return ( events ^ SERIALAPP_SEND_EVT );
   \   0000D5   EE           MOV     A,R6
   \   0000D6   6401         XRL     A,#0x1
   \   0000D8   02....       LJMP    ??SerialApp_ProcessEvent_2 & 0xFFFF
    854            }
    855            
    856            if ( events & RFID_EVT )  
   \                     ??SerialApp_ProcessEvent_8:
   \   0000DB   5404         ANL     A,#0x4
   \   0000DD   7003         JNZ     $+5
   \   0000DF   02....       LJMP    ??SerialApp_ProcessEvent_9 & 0xFFFF
    857            {
    858              uint8 state;
    859              static uint8 hasCardOld = FALSE;
    860              static uint8 hasCardNow = FALSE;
    861              hasCardOld = hasCardNow;
   \   0000E2   90....       MOV     DPTR,#??hasCardNow
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   90....       MOV     DPTR,#??hasCardOld
   \   0000E9   F0           MOVX    @DPTR,A
    862              hasCardNow = Request(RF_CMD_REQUEST_STD);
   \   0000EA                ; Setup parameters for call to function Request
   \   0000EA   7926         MOV     R1,#0x26
   \   0000EC   12....       LCALL   ??Request?relay
   \   0000EF   E9           MOV     A,R1
   \   0000F0   90....       MOV     DPTR,#??hasCardNow
   \   0000F3   F0           MOVX    @DPTR,A
    863              if(hasCardOld != hasCardNow) //·µ»Ø1ËµÃ÷¼ì²âµ½¿¨
   \   0000F4   90....       MOV     DPTR,#??hasCardOld
   \   0000F7   E0           MOVX    A,@DPTR
   \   0000F8   F8           MOV     R0,A
   \   0000F9   90....       MOV     DPTR,#??hasCardNow
   \   0000FC   E0           MOVX    A,@DPTR
   \   0000FD   68           XRL     A,R0
   \   0000FE   606F         JZ      ??SerialApp_ProcessEvent_10
    864              {
    865                state = ReadCardNum(); //¶Á¿¨ºÅ£¬´æ´¢ÔÚCardNoÊý×éÀïÃæ
    866                if(!state) //¶Á¿¨ÕýÈ·  
   \   000100                ; Setup parameters for call to function ReadCardNum
   \   000100   12....       LCALL   ??ReadCardNum?relay
   \   000103   E9           MOV     A,R1
   \   000104   7058         JNZ     ??SerialApp_ProcessEvent_11
    867                {
    868                  BEEP = 1; 
   \   000106   D280         SETB    0x80.0
    869                  UART0_Format.Command = SEND;
   \   000108   90....       MOV     DPTR,#UART0_Format + 4
   \   00010B   7401         MOV     A,#0x1
   \   00010D   F0           MOVX    @DPTR,A
    870                  UART0_Format.Data[0] = CardNo[0]; //d2345678
   \   00010E   90....       MOV     DPTR,#CardNo
   \   000111   E0           MOVX    A,@DPTR
   \   000112   90....       MOV     DPTR,#UART0_Format + 5
   \   000115   F0           MOVX    @DPTR,A
    871                  UART0_Format.Data[1] = CardNo[1]; 
   \   000116   90....       MOV     DPTR,#CardNo + 1
   \   000119   E0           MOVX    A,@DPTR
   \   00011A   90....       MOV     DPTR,#UART0_Format + 6
   \   00011D   F0           MOVX    @DPTR,A
    872                  UART0_Format.Data[2] = CardNo[2];
   \   00011E   90....       MOV     DPTR,#CardNo + 2
   \   000121   E0           MOVX    A,@DPTR
   \   000122   90....       MOV     DPTR,#UART0_Format + 7
   \   000125   F0           MOVX    @DPTR,A
    873                  UART0_Format.Data[3] = CardNo[3]; 
   \   000126   90....       MOV     DPTR,#CardNo + 3
   \   000129   E0           MOVX    A,@DPTR
   \   00012A   90....       MOV     DPTR,#UART0_Format + 8
   \   00012D   F0           MOVX    @DPTR,A
    874                  MIF_READ(RevBuffer, block_numset(1));  //¶Á³öÊý¾Ý¿é0µÄÊý¾Ý·ÅÔÚRevBufferÀïÃæ
   \   00012E                ; Setup parameters for call to function MIF_READ
   \   00012E                ; Setup parameters for call to function block_numset
   \   00012E   7901         MOV     R1,#0x1
   \   000130   12....       LCALL   ??block_numset?relay
   \   000133   7A..         MOV     R2,#RevBuffer & 0xff
   \   000135   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   000137   12....       LCALL   ??MIF_READ?relay
    875                  UART0_Format.Data[4] = RevBuffer[2];   //¿¨ÄÚ¿é0ÖÐµÄµÚÒ»¸ö×Ö½ÚÎª½ð¶î¸ßÎ»
   \   00013A   90....       MOV     DPTR,#RevBuffer + 2
   \   00013D   E0           MOVX    A,@DPTR
   \   00013E   90....       MOV     DPTR,#UART0_Format + 9
   \   000141   F0           MOVX    @DPTR,A
    876                  UART0_Format.Data[5] = RevBuffer[3];   //¿¨ÄÚ¿é0ÖÐµÄµÚ¶þ¸ö×Ö½ÚÎª½ð¶îµÍÎ»
   \   000142   90....       MOV     DPTR,#RevBuffer + 3
   \   000145   E0           MOVX    A,@DPTR
   \   000146   90....       MOV     DPTR,#UART0_Format + 10
   \   000149   12....       LCALL   ?Subroutine11 & 0xFFFF
    877                  osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
    878                  MicroWait(50000);
   \                     ??CrossCallReturnLabel_50:
   \   00014C                ; Setup parameters for call to function Onboard_wait
   \   00014C   7A50         MOV     R2,#0x50
   \   00014E   7BC3         MOV     R3,#-0x3d
   \   000150   12....       LCALL   ??Onboard_wait?relay
    879                  MicroWait(50000);
   \   000153                ; Setup parameters for call to function Onboard_wait
   \   000153   7A50         MOV     R2,#0x50
   \   000155   7BC3         MOV     R3,#-0x3d
   \   000157   12....       LCALL   ??Onboard_wait?relay
    880                  BEEP = 0;
   \   00015A   C280         CLR     0x80.0
   \   00015C   8011         SJMP    ??SerialApp_ProcessEvent_10
    881                }
    882                else
    883                {
    884                  CardNo[0] = CardNo[1] = CardNo[2] = CardNo[3] = 0;
   \                     ??SerialApp_ProcessEvent_11:
   \   00015E   90....       MOV     DPTR,#CardNo + 3
   \   000161   E4           CLR     A
   \   000162   F0           MOVX    @DPTR,A
   \   000163   90....       MOV     DPTR,#CardNo + 2
   \   000166   F0           MOVX    @DPTR,A
   \   000167   90....       MOV     DPTR,#CardNo + 1
   \   00016A   F0           MOVX    @DPTR,A
   \   00016B   90....       MOV     DPTR,#CardNo
   \   00016E   F0           MOVX    @DPTR,A
    885                }
    886              }
    887              osal_start_timerEx(SerialApp_TaskID, RFID_EVT, 1000);
   \                     ??SerialApp_ProcessEvent_10:
   \   00016F                ; Setup parameters for call to function osal_start_timerEx
   \   00016F   7CE8         MOV     R4,#-0x18
   \   000171   7D03         MOV     R5,#0x3
   \   000173   7A04         MOV     R2,#0x4
   \   000175   7B00         MOV     R3,#0x0
   \   000177   90....       MOV     DPTR,#SerialApp_TaskID
   \   00017A   E0           MOVX    A,@DPTR
   \   00017B   F9           MOV     R1,A
   \   00017C   12....       LCALL   ??osal_start_timerEx?relay
    888              return ( events ^ RFID_EVT );
   \   00017F   EE           MOV     A,R6
   \   000180   6404         XRL     A,#0x4
   \   000182   02....       LJMP    ??SerialApp_ProcessEvent_2 & 0xFFFF
    889            }
    890          
    891            return ( 0 );  // Discard unknown events.
   \                     ??SerialApp_ProcessEvent_9:
   \   000185   7A00         MOV     R2,#0x0
   \   000187   7B00         MOV     R3,#0x0
   \                     ??SerialApp_ProcessEvent_4:
   \   000189   02....       LJMP    ?Subroutine1 & 0xFFFF
   \   00018C                REQUIRE _A_P0
    892          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   F0           MOVX    @DPTR,A
   \   000001                ; Setup parameters for call to function osal_set_event
   \   000001                ; Setup parameters for call to function osal_set_event
   \   000001   7A01         MOV     R2,#0x1
   \   000003                REQUIRE ??Subroutine25_0
   \   000003                ; // Fall through to label ??Subroutine25_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine25_0:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#SerialApp_TaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??hasCardOld:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??hasCardNow:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z
    893          
    894          /*********************************************************************
    895           * @fn      SerialApp_ProcessMSGCmd
    896           *
    897           * @brief   Data message processor callback. This function processes
    898           *          any incoming data - probably from other devices. Based
    899           *          on the cluster ID, perform the intended action.
    900           *
    901           * @param   pkt - pointer to the incoming message packet
    902           *
    903           * @return  TRUE if the 'pkt' parameter is being used and will be freed later,
    904           *          FALSE otherwise.
    905           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    906          void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt )  //´¦Àí½ÓÊÕµ½µÄRFÏûÏ¢
   \                     SerialApp_ProcessMSGCmd:
    907          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
    908            static UART_Format *receiveData;
    909            static uint8  secNR;
    910            uint8  status;
    911            uint8  ctimeH,ctimeL;
    912            uint16 ctime;
    913            static uint16 overage;
    914            static UART_Format Rsp;
    915            Rsp.Header_1 = 0xee;
   \   000005   90....       MOV     DPTR,#??Rsp
   \   000008   12....       LCALL   ?Subroutine12 & 0xFFFF
    916            Rsp.Header_2 = 0xcc;
    917            Rsp.NodeSeq  = 0x01;
    918            Rsp.NodeID   = RFID_1356;
    919            Rsp.Command  = MSG_RSP;
   \                     ??CrossCallReturnLabel_7:
   \   00000B   A3           INC     DPTR
   \   00000C   74DD         MOV     A,#-0x23
   \   00000E   F0           MOVX    @DPTR,A
    920            Rsp.Tailer   = 0xff;
   \   00000F   90....       MOV     DPTR,#??Rsp + 15
   \   000012   74FF         MOV     A,#-0x1
   \   000014   F0           MOVX    @DPTR,A
    921            switch ( pkt->clusterId )
   \   000015   8A82         MOV     DPL,R2
   \   000017   8B83         MOV     DPH,R3
   \   000019   A3           INC     DPTR
   \   00001A   A3           INC     DPTR
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   6401         XRL     A,#0x1
   \   000020   7002         JNZ     ??SerialApp_ProcessMSGCmd_0
   \   000022   A3           INC     DPTR
   \   000023   E0           MOVX    A,@DPTR
   \                     ??SerialApp_ProcessMSGCmd_0:
   \   000024   6003         JZ      $+5
   \   000026   02....       LJMP    ??SerialApp_ProcessMSGCmd_1 & 0xFFFF
    922            {
    923             case SERIALAPP_CLUSTERID1:  //´¦Àí¸÷¸ö´«¸ÐÆ÷½ÚÊý¾Ý    
    924               receiveData = (UART_Format *)(pkt->cmd.Data);
   \   000029   EA           MOV     A,R2
   \   00002A   2422         ADD     A,#0x22
   \   00002C   12....       LCALL   ??Subroutine23_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_47:
   \   00002F   F8           MOV     R0,A
   \   000030   A3           INC     DPTR
   \   000031   E0           MOVX    A,@DPTR
   \   000032   F9           MOV     R1,A
   \   000033   90....       MOV     DPTR,#??receiveData
   \   000036   E8           MOV     A,R0
   \   000037   F0           MOVX    @DPTR,A
   \   000038   A3           INC     DPTR
   \   000039   E9           MOV     A,R1
   \   00003A   F0           MOVX    @DPTR,A
    925               HalLedBlink(HAL_LED_1,1,50,200);
   \   00003B                ; Setup parameters for call to function HalLedBlink
   \   00003B   7CC8         MOV     R4,#-0x38
   \   00003D   7D00         MOV     R5,#0x0
   \   00003F   7B32         MOV     R3,#0x32
   \   000041   7A01         MOV     R2,#0x1
   \   000043   7901         MOV     R1,#0x1
   \   000045   12....       LCALL   ??HalLedBlink?relay
    926               if((receiveData->Header_1==0xcc)&&(receiveData->Header_2==0xee)&&(receiveData->Tailer==0xff)) //Ð£Ñé°üÍ·°üÎ²
   \   000048   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   00004B   E0           MOVX    A,@DPTR
   \   00004C   64CC         XRL     A,#0xcc
   \   00004E   6003         JZ      $+5
   \   000050   02....       LJMP    ??SerialApp_ProcessMSGCmd_1 & 0xFFFF
   \   000053   90....       MOV     DPTR,#??receiveData + 1
   \   000056   E0           MOVX    A,@DPTR
   \   000057   F583         MOV     DPH,A
   \   000059   8882         MOV     DPL,R0
   \   00005B   A3           INC     DPTR
   \   00005C   E0           MOVX    A,@DPTR
   \   00005D   64EE         XRL     A,#0xee
   \   00005F   6003         JZ      $+5
   \   000061   02....       LJMP    ??SerialApp_ProcessMSGCmd_1 & 0xFFFF
   \   000064   90....       MOV     DPTR,#??receiveData
   \   000067   E0           MOVX    A,@DPTR
   \   000068   240F         ADD     A,#0xf
   \   00006A   F8           MOV     R0,A
   \   00006B   A3           INC     DPTR
   \   00006C   E0           MOVX    A,@DPTR
   \   00006D   3400         ADDC    A,#0x0
   \   00006F   F9           MOV     R1,A
   \   000070   8882         MOV     DPL,R0
   \   000072   8983         MOV     DPH,R1
   \   000074   E0           MOVX    A,@DPTR
   \   000075   F4           CPL     A
   \   000076   6003         JZ      $+5
   \   000078   02....       LJMP    ??SerialApp_ProcessMSGCmd_1 & 0xFFFF
    927               {
    928                 if(receiveData->NodeID == RFID_1356) //ÊÕµ½Êý¾ÝºóÍ¨¹ý´®¿Ú·¢ËÍ¸øRFIDÄ£¿é
   \   00007B   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_4:
   \   00007E   E0           MOVX    A,@DPTR
   \   00007F   6410         XRL     A,#0x10
   \   000081   6003         JZ      $+5
   \   000083   02....       LJMP    ??SerialApp_ProcessMSGCmd_1 & 0xFFFF
    929                 {
    930                   HalLedSet(HAL_LED_2, HAL_LED_MODE_OFF);
   \   000086                ; Setup parameters for call to function HalLedSet
   \   000086   7A00         MOV     R2,#0x0
   \   000088   7902         MOV     R1,#0x2
   \   00008A   12....       LCALL   ??HalLedSet?relay
    931           	 do{	
    932          	     status = Request(RF_CMD_REQUEST_STD);
    933                   }while(!status);	
   \                     ??SerialApp_ProcessMSGCmd_2:
   \   00008D                ; Setup parameters for call to function Request
   \   00008D   7926         MOV     R1,#0x26
   \   00008F   12....       LCALL   ??Request?relay
   \   000092   E9           MOV     A,R1
   \   000093   60F8         JZ      ??SerialApp_ProcessMSGCmd_2
    934                   HalLedSet(HAL_LED_2, HAL_LED_MODE_ON);
   \   000095                ; Setup parameters for call to function HalLedSet
   \   000095   7A01         MOV     R2,#0x1
   \   000097   7902         MOV     R1,#0x2
   \   000099   12....       LCALL   ??HalLedSet?relay
    935          	 status = ReadCardNum();//µÈ´ý¶ÁÈ¡¿¨ºÅ  
    936                   if(!status)
   \   00009C                ; Setup parameters for call to function ReadCardNum
   \   00009C   12....       LCALL   ??ReadCardNum?relay
   \   00009F   E9           MOV     A,R1
   \   0000A0   706E         JNZ     ??SerialApp_ProcessMSGCmd_1
    937                   {
    938                     if(receiveData->Command == INCREASE)
   \   0000A2   12....       LCALL   ?Subroutine10 & 0xFFFF
   \                     ??CrossCallReturnLabel_5:
   \   0000A5   A3           INC     DPTR
   \   0000A6   E0           MOVX    A,@DPTR
   \   0000A7   6402         XRL     A,#0x2
   \   0000A9   7009         JNZ     ??SerialApp_ProcessMSGCmd_3
    939                     {         
    940                       secNR  = block_numset(1);            //²Ù×÷Êý¾Ý¿é1
   \   0000AB                ; Setup parameters for call to function block_numset
   \   0000AB   12....       LCALL   ?Subroutine9 & 0xFFFF
    941                       MIF_READ(RevBuffer, secNR);          //¶Á³öÊý¾Ý¿é0µÄÊý¾Ý·ÅÔÚRevBufferÀïÃæ
    942                       ctimeH = RevBuffer[2];                 //¿¨ÄÚ¿é0ÖÐµÄµÚÒ»¸ö×Ö½ÚÎª½ð¶î¸ßÎ»
    943                       ctimeL = RevBuffer[3];                 //¿¨ÄÚ¿é0ÖÐµÄµÚ¶þ¸ö×Ö½ÚÎª½ð¶îµÍÎ»
    944            
    945                       ctime  = ctimeH<<8|ctimeL;             //²Ù×÷½ð¶îµÄ¸ñÊ½×ª»»     				
    946                       ctime += (receiveData->Data[0]<<8)|receiveData->Data[1];//¿Û³ýÖ¸¶¨µÄ½ð¶î
    947                       overage = ctime;  //µÃµ½¿¨ÄÚÊ£ÓàµÄ½ð¶î
    948            
    949                       RevBuffer[3] = ctime;//°ÑµÍ×Ö½ÚÐ´Èë»º´æÆ÷ÖÐ
    950                       ctime >>= 8;
    951                       RevBuffer[2] = ctime;//°Ñ¸ß×Ö½ÚÐ´Èë»º´æÆ÷ÖÐ
    952            
    953                        /////Ð´Êý¾Ý¿éµÄ²Ù×÷////////////
    954                       secNR  = block_numset(1);      //²Ù×÷Êý¾Ý¿é1
    955                       MIF_Write(RevBuffer, secNR); //Ð´¿é
    956                     }
   \                     ??CrossCallReturnLabel_2:
   \   0000AE   28           ADD     A,R0
   \   0000AF   F8           MOV     R0,A
   \   0000B0   EB           MOV     A,R3
   \   0000B1   39           ADDC    A,R1
   \   0000B2   8019         SJMP    ??SerialApp_ProcessMSGCmd_4
    957                     else if(receiveData->Command == REDUCE)
   \                     ??SerialApp_ProcessMSGCmd_3:
   \   0000B4   90....       MOV     DPTR,#??receiveData + 1
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   F583         MOV     DPH,A
   \   0000BA   8882         MOV     DPL,R0
   \   0000BC   A3           INC     DPTR
   \   0000BD   A3           INC     DPTR
   \   0000BE   A3           INC     DPTR
   \   0000BF   A3           INC     DPTR
   \   0000C0   E0           MOVX    A,@DPTR
   \   0000C1   6403         XRL     A,#0x3
   \   0000C3   7021         JNZ     ??SerialApp_ProcessMSGCmd_5
    958                     {
    959                       secNR  = block_numset(1);            //²Ù×÷Êý¾Ý¿é1
   \   0000C5                ; Setup parameters for call to function block_numset
   \   0000C5   12....       LCALL   ?Subroutine9 & 0xFFFF
    960                       MIF_READ(RevBuffer,secNR);  //¶Á³öÊý¾Ý¿é0µÄÊý¾Ý·ÅÔÚRevBufferÀïÃæ
    961                       ctimeH = RevBuffer[2];                 //¿¨ÄÚ¿é0ÖÐµÄµÚÒ»¸ö×Ö½ÚÎª½ð¶î¸ßÎ»
    962                       ctimeL = RevBuffer[3];                 //¿¨ÄÚ¿é0ÖÐµÄµÚ¶þ¸ö×Ö½ÚÎª½ð¶îµÍÎ»
    963            
    964                       ctime = ctimeH<<8|ctimeL;             //²Ù×÷½ð¶îµÄ¸ñÊ½×ª»»				
    965                       ctime -= (receiveData->Data[0]<<8)|receiveData->Data[1];//¿Û³ýÖ¸¶¨µÄ½ð¶î
   \                     ??CrossCallReturnLabel_3:
   \   0000C8   C3           CLR     C
   \   0000C9   98           SUBB    A,R0
   \   0000CA   F8           MOV     R0,A
   \   0000CB   EB           MOV     A,R3
   \   0000CC   99           SUBB    A,R1
   \                     ??SerialApp_ProcessMSGCmd_4:
   \   0000CD   F9           MOV     R1,A
    966                       overage = ctime;  //µÃµ½¿¨ÄÚÊ£ÓàµÄ½ð¶î
   \   0000CE   90....       MOV     DPTR,#??overage
   \   0000D1   E8           MOV     A,R0
   \   0000D2   F0           MOVX    @DPTR,A
   \   0000D3   A3           INC     DPTR
   \   0000D4   E9           MOV     A,R1
   \   0000D5   F0           MOVX    @DPTR,A
    967                       
    968                       RevBuffer[3] = ctime;//°ÑµÍ×Ö½ÚÐ´Èë»º´æÆ÷ÖÐ
   \   0000D6   E8           MOV     A,R0
   \   0000D7   90....       MOV     DPTR,#RevBuffer + 3
   \   0000DA   F0           MOVX    @DPTR,A
    969                       ctime >>= 8;
    970                       RevBuffer[2] = ctime;//°Ñ¸ß×Ö½ÚÐ´Èë»º´æÆ÷ÖÐ
   \   0000DB   E9           MOV     A,R1
   \   0000DC   90....       MOV     DPTR,#RevBuffer + 2
   \   0000DF   F0           MOVX    @DPTR,A
    971            
    972                        /////Ð´Êý¾Ý¿éµÄ²Ù×÷////////////
    973                       secNR  = block_numset(1);      //²Ù×÷Êý¾Ý¿é1
   \   0000E0                ; Setup parameters for call to function block_numset
   \   0000E0   12....       LCALL   ?Subroutine16 & 0xFFFF
    974                       MIF_Write(RevBuffer, secNR); //Ð´¿é
    975                     }           
   \                     ??CrossCallReturnLabel_12:
   \   0000E3   12....       LCALL   ??MIF_Write?relay
    976                     //do{
    977                     //  status = Request(RF_CMD_REQUEST_STD); 
    978                     //}//¿Û¿î³É¹¦ºóµÈ´ý°Ñ¿¨ÒÆ¿ª¸ÐÓ¦Çø
    979                     //while(status);
    980                     Rsp.Data[0] = overage>>8;
   \                     ??SerialApp_ProcessMSGCmd_5:
   \   0000E6   90....       MOV     DPTR,#??overage + 1
   \   0000E9   E0           MOVX    A,@DPTR
   \   0000EA   90....       MOV     DPTR,#??Rsp + 5
   \   0000ED   F0           MOVX    @DPTR,A
    981                     Rsp.Data[1] = overage; 
   \   0000EE   90....       MOV     DPTR,#??overage
   \   0000F1   E0           MOVX    A,@DPTR
   \   0000F2   90....       MOV     DPTR,#??Rsp + 6
   \   0000F5   F0           MOVX    @DPTR,A
    982                     SerialApp_OTAData(&SerialApp_TxAddr, SERIALAPP_CLUSTERID1, &Rsp, sizeof(UART_Format));
   \   0000F6                ; Setup parameters for call to function SerialApp_OTAData
   \   0000F6   75..10       MOV     ?V0 + 0,#0x10
   \   0000F9   78..         MOV     R0,#?V0 + 0
   \   0000FB   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000FE   7C..         MOV     R4,#??Rsp & 0xff
   \   000100   7D..         MOV     R5,#(??Rsp >> 8) & 0xff
   \   000102   7901         MOV     R1,#0x1
   \   000104   7A..         MOV     R2,#SerialApp_TxAddr & 0xff
   \   000106   7B..         MOV     R3,#(SerialApp_TxAddr >> 8) & 0xff
   \   000108   12....       LCALL   ??SerialApp_OTAData?relay
   \   00010B   7401         MOV     A,#0x1
   \   00010D   12....       LCALL   ?DEALLOC_XSTACK8
    983                   }
    984                 }
    985               }
    986              break;
    987          
    988            case SERIALAPP_CLUSTERID2:
    989              break;
    990          
    991              default:
    992                break;
    993            }
    994          }
   \                     ??SerialApp_ProcessMSGCmd_1:
   \   000110   02....       LJMP    ??Subroutine21_0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_17:
   \   000003   A3           INC     DPTR
   \   000004   A3           INC     DPTR
   \   000005   A3           INC     DPTR
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   90....       MOV     DPTR,#??receiveData
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F8           MOV     R0,A
   \   000005   A3           INC     DPTR
   \   000006   E0           MOVX    A,@DPTR
   \   000007   F583         MOV     DPH,A
   \   000009   8882         MOV     DPL,R0
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_13:
   \   000003   12....       LCALL   ??MIF_READ?relay
   \   000006   90....       MOV     DPTR,#RevBuffer + 2
   \   000009   E0           MOVX    A,@DPTR
   \   00000A   F9           MOV     R1,A
   \   00000B   A3           INC     DPTR
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   FA           MOV     R2,A
   \   00000E   E9           MOV     A,R1
   \   00000F   FB           MOV     R3,A
   \   000010   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000013   A3           INC     DPTR
   \   000014   A3           INC     DPTR
   \   000015   E0           MOVX    A,@DPTR
   \   000016   F9           MOV     R1,A
   \   000017   90....       MOV     DPTR,#??receiveData
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   FC           MOV     R4,A
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   F583         MOV     DPH,A
   \   000020   8C82         MOV     DPL,R4
   \   000022   A3           INC     DPTR
   \   000023   A3           INC     DPTR
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   A3           INC     DPTR
   \   000027   A3           INC     DPTR
   \   000028   E0           MOVX    A,@DPTR
   \   000029   F8           MOV     R0,A
   \   00002A   EA           MOV     A,R2
   \   00002B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   7901         MOV     R1,#0x1
   \   000002   12....       LCALL   ??block_numset?relay
   \   000005   E9           MOV     A,R1
   \   000006   90....       MOV     DPTR,#??secNR
   \   000009   F0           MOVX    @DPTR,A
   \   00000A                ; Setup parameters for call to function MIF_Write
   \   00000A                ; Setup parameters for call to function MIF_READ
   \   00000A                ; Setup parameters for call to function MIF_READ
   \   00000A   7A..         MOV     R2,#RevBuffer & 0xff
   \   00000C   7B..         MOV     R3,#(RevBuffer >> 8) & 0xff
   \   00000E   22           RET

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??receiveData:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??secNR:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??overage:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
   \                     ??Rsp:
   \   000000                DS 16
   \   000010                REQUIRE __INIT_XDATA_Z
    995          
    996          /*********************************************************************
    997           */
    998          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    999          void SerialApp_OTAData(afAddrType_t *txaddr, uint8 cID, void *p, uint8 len) //·¢ËÍº¯Êý
   \                     SerialApp_OTAData:
   1000          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   740A         MOV     A,#0xa
   \   000009   12....       LCALL   ?XSTACK_DISP0_8
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
   1001            if (afStatus_SUCCESS != AF_DataRequest(txaddr, //·¢ËÍµØÖ·
   1002                                                     (endPointDesc_t *)&SerialApp_epDesc, //endpointÃèÊö
   1003                                                      cID, //clusterID
   1004                                                      len, p, //·¢ËÍÊý¾Ý°üµÄ³¤¶ÈºÍµØÖ·
   1005                                                      &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
   \   00000E                ; Setup parameters for call to function AF_DataRequest
   \   00000E   75..1E       MOV     ?V0 + 0,#0x1e
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000016   75....       MOV     ?V0 + 0,#SerialApp_MsgID & 0xff
   \   000019   75....       MOV     ?V0 + 1,#(SerialApp_MsgID >> 8) & 0xff
   \   00001C   78..         MOV     R0,#?V0 + 0
   \   00001E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000021   8C..         MOV     ?V0 + 0,R4
   \   000023   8D..         MOV     ?V0 + 1,R5
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   89..         MOV     ?V0 + 0,R1
   \   00002C   75..00       MOV     ?V0 + 1,#0x0
   \   00002F   78..         MOV     R0,#?V0 + 0
   \   000031   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000034   8E..         MOV     ?V0 + 0,R6
   \   000036   78..         MOV     R0,#?V0 + 0
   \   000038   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003B   7900         MOV     R1,#0x0
   \   00003D   7C..         MOV     R4,#SerialApp_epDesc & 0xff
   \   00003F   7D..         MOV     R5,#(SerialApp_epDesc >> 8) & 0xff
   \   000041   12....       LCALL   ??AF_DataRequest?relay
   \   000044   7409         MOV     A,#0x9
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   E9           MOV     A,R1
   \   00004A   700D         JNZ     ??SerialApp_OTAData_0
   1006            {
   1007            }
   1008            else
   1009            {
   1010              HalLedBlink(HAL_LED_1,1,50,200);
   \   00004C                ; Setup parameters for call to function HalLedBlink
   \   00004C   7CC8         MOV     R4,#-0x38
   \   00004E   7D00         MOV     R5,#0x0
   \   000050   7B32         MOV     R3,#0x32
   \   000052   7A01         MOV     R2,#0x1
   \   000054   7901         MOV     R1,#0x1
   \   000056   12....       LCALL   ??HalLedBlink?relay
   1011            }
   1012          }
   \                     ??SerialApp_OTAData_0:
   \   000059   02....       LJMP    ?Subroutine3 & 0xFFFF
   1013          
   1014          /*********************************************************************
   1015           * @fn      SerialApp_CallBack
   1016           *
   1017           * @brief   Send data OTA.
   1018           *
   1019           * @param   port - UART port.
   1020           * @param   event - the UART port event flag.
   1021           *
   1022           * @return  none
   1023           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   1024          static void SerialApp_CallBack(uint8 port, uint8 event)
   \                     SerialApp_CallBack:
   1025          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   1026            (void)port;
   1027          
   1028            if ((event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT)) && !SerialApp_TxLen) //´®¿Ú½ÓÊÕµ½Êý¾Ý°ü
   \   000007   7407         MOV     A,#0x7
   \   000009   5E           ANL     A,R6
   \   00000A   6061         JZ      ??SerialApp_CallBack_0
   \   00000C   90....       MOV     DPTR,#SerialApp_TxLen
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   705B         JNZ     ??SerialApp_CallBack_0
   1029            {
   1030              SerialApp_TxLen = HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf, SERIAL_APP_TX_MAX); //½«´®¿ÚÊý¾Ý¶ÁÈëbuf
   \   000012                ; Setup parameters for call to function HalUARTRead
   \   000012   7C14         MOV     R4,#0x14
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A..         MOV     R2,#SerialApp_TxBuf & 0xff
   \   000018   7B..         MOV     R3,#(SerialApp_TxBuf >> 8) & 0xff
   \   00001A   7900         MOV     R1,#0x0
   \   00001C   12....       LCALL   ??HalUARTRead?relay
   \   00001F   EA           MOV     A,R2
   \   000020   90....       MOV     DPTR,#SerialApp_TxLen
   \   000023   F0           MOVX    @DPTR,A
   1031              if(SerialApp_TxLen)
   \   000024   6042         JZ      ??CrossCallReturnLabel_51
   1032              {
   1033                if(SerialApp_TxBuf[0] == 0xaa && SerialApp_TxBuf[1] == 0xbb) //Ð£Ñé°üÍ·
   \   000026   90....       MOV     DPTR,#SerialApp_TxBuf
   \   000029   E0           MOVX    A,@DPTR
   \   00002A   64AA         XRL     A,#0xaa
   \   00002C   703A         JNZ     ??CrossCallReturnLabel_51
   \   00002E   A3           INC     DPTR
   \   00002F   E0           MOVX    A,@DPTR
   \   000030   64BB         XRL     A,#0xbb
   \   000032   7034         JNZ     ??CrossCallReturnLabel_51
   1034                {
   1035                  if(SerialApp_TxBuf[2] == 0x06 && SerialApp_TxBuf[3] == 0x20) //¶ÁÈ¡¿¨ºÅ
   \   000034   A3           INC     DPTR
   \   000035   E0           MOVX    A,@DPTR
   \   000036   6406         XRL     A,#0x6
   \   000038   702E         JNZ     ??CrossCallReturnLabel_51
   \   00003A   A3           INC     DPTR
   \   00003B   E0           MOVX    A,@DPTR
   \   00003C   6420         XRL     A,#0x20
   \   00003E   7028         JNZ     ??CrossCallReturnLabel_51
   1036                  {
   1037                    UART0_Format.Command = 0x01; //µÚÒ»¸öÃüÁî
   \   000040   90....       MOV     DPTR,#UART0_Format + 4
   \   000043   7401         MOV     A,#0x1
   \   000045   F0           MOVX    @DPTR,A
   1038                    UART0_Format.Data[0] = SerialApp_TxBuf[4];
   \   000046   90....       MOV     DPTR,#SerialApp_TxBuf + 4
   \   000049   E0           MOVX    A,@DPTR
   \   00004A   90....       MOV     DPTR,#UART0_Format + 5
   \   00004D   F0           MOVX    @DPTR,A
   1039                    UART0_Format.Data[1] = SerialApp_TxBuf[5];   
   \   00004E   90....       MOV     DPTR,#SerialApp_TxBuf + 5
   \   000051   E0           MOVX    A,@DPTR
   \   000052   90....       MOV     DPTR,#UART0_Format + 6
   \   000055   F0           MOVX    @DPTR,A
   1040                    UART0_Format.Data[2] = SerialApp_TxBuf[6];
   \   000056   90....       MOV     DPTR,#SerialApp_TxBuf + 6
   \   000059   E0           MOVX    A,@DPTR
   \   00005A   90....       MOV     DPTR,#UART0_Format + 7
   \   00005D   F0           MOVX    @DPTR,A
   1041                    UART0_Format.Data[3] = SerialApp_TxBuf[7]; 
   \   00005E   90....       MOV     DPTR,#SerialApp_TxBuf + 7
   \   000061   E0           MOVX    A,@DPTR
   \   000062   90....       MOV     DPTR,#UART0_Format + 8
   \   000065   12....       LCALL   ?Subroutine11 & 0xFFFF
   1042                    osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   1043                  }
   1044                }
   1045              }
   1046              SerialApp_TxLen = 0;  
   \                     ??CrossCallReturnLabel_51:
   \   000068   90....       MOV     DPTR,#SerialApp_TxLen
   \   00006B   E4           CLR     A
   \   00006C   F0           MOVX    @DPTR,A
   1047            }
   1048          }
   \                     ??SerialApp_CallBack_0:
   \   00006D   02....       LJMP    ??Subroutine21_0 & 0xFFFF

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??WriteReg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    WriteReg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ReadReg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ReadReg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??FM1702BusSel?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    FM1702BusSel

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Fifo_Write?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Fifo_Write

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Fifo_Read?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Fifo_Read

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Judge_Req?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Judge_Req

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??InitFM1702SL?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    InitFM1702SL

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Clear_FIFO?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Clear_FIFO

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Command_Send?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Command_Send

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??keyto?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    keyto

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??block_numset?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    block_numset

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Request?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Request

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Load_key_CPY?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Load_key_CPY

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??M500HostCodeKey?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    M500HostCodeKey

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??ReadCardNum?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    ReadCardNum

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Authentication?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Authentication

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Select_Card?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Select_Card

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??Check_UID?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    Check_UID

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??AntiColl?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    AntiColl

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MIF_READ?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MIF_READ

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MIF_Write?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MIF_Write

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessMSGCmd?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessMSGCmd

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_OTAData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_OTAData

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_CallBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_CallBack
   1049          
   1050          /*********************************************************************
   1051          *********************************************************************/

   Maximum stack usage in bytes:

     Function                     ISTACK PSTACK XSTACK
     --------                     ------ ------ ------
     AntiColl                         1      0      9
       -> WriteReg                    0      0     18
       -> Command_Send                0      0     18
       -> ReadReg                     0      0     18
       -> Fifo_Read                   0      0     18
       -> Check_UID                   0      0     18
     Authentication                   1      0      9
       -> WriteReg                    0      0     18
       -> Command_Send                0      0     18
       -> Command_Send                0      0     18
       -> ReadReg                     0      0     18
     Check_UID                        0      0     20
     Clear_FIFO                       0      0     19
       -> ReadReg                     0      0     18
       -> WriteReg                    0      0     18
       -> ReadReg                     0      0     18
     Command_Send                     0      0     22
       -> WriteReg                    0      0     20
       -> Clear_FIFO                  0      0     20
       -> Fifo_Write                  0      0     20
       -> WriteReg                    0      0     20
       -> ReadReg                     0      0     20
     FM1702BusSel                     0      0      9
       -> WriteReg                    0      0     18
       -> ReadReg                     0      0     18
       -> WriteReg                    0      0     18
     Fifo_Read                        1      0     23
       -> ReadReg                     0      0     24
       -> ReadReg                     0      0     24
     Fifo_Write                       0      0     22
       -> WriteReg                    0      0     24
       -> Onboard_wait                0      0     24
     InitFM1702SL                     2      0     38
       -> Onboard_wait                4      0      0
       -> Onboard_wait                4      0      0
       -> Onboard_wait                4      0      0
       -> ReadReg                     4      0      0
       -> FM1702BusSel                4      0      0
       -> WriteReg                    4      0      0
       -> WriteReg                    4      0      0
       -> WriteReg                    4      0      0
       -> WriteReg                    4      0      0
       -> WriteReg                    4      0      0
       -> WriteReg                    4      0      0
     Judge_Req                        2      0      9
     Load_key_CPY                     2      0     12
       -> M500HostCodeKey             4      0     24
       -> Command_Send                4      0     24
       -> ReadReg                     4      0     24
     M500HostCodeKey                  1      0     21
     MIF_READ                         1      0     21
       -> WriteReg                    0      0     18
       -> Command_Send                0      0     18
       -> ReadReg                     0      0     18
       -> Fifo_Read                   0      0     18
     MIF_Write                        1      0     20
       -> WriteReg                    0      0     22
       -> WriteReg                    0      0     22
       -> WriteReg                    0      0     22
       -> Command_Send                0      0     22
       -> ReadReg                     0      0     22
       -> Fifo_Read                   0      0     22
       -> Command_Send                0      0     22
       -> ReadReg                     0      0     22
     ReadCardNum                      2      0     12
       -> AntiColl                    4      0      0
       -> Select_Card                 4      0      0
       -> keyto                       4      0      0
       -> Load_key_CPY                4      0      0
       -> Authentication              4      0      0
     ReadReg                          0      0     21
       -> Onboard_wait                0      0     18
       -> SPIOneByte                  0      0     18
       -> SPIOneByte                  0      0     18
     Request                          0      0     21
       -> WriteReg                    0      0     18
       -> WriteReg                    0      0     18
       -> WriteReg                    0      0     18
       -> ReadReg                     0      0     18
       -> WriteReg                    0      0     18
       -> WriteReg                    0      0     18
       -> Command_Send                0      0     18
       -> Fifo_Read                   0      0     18
       -> Judge_Req                   0      0     18
     Select_Card                      3      0      0
       -> WriteReg                    4      0      0
       -> Command_Send                4      0      0
       -> Fifo_Read                   4      0      0
     SerialApp_CallBack               0      0      9
       -> HalUARTRead                 0      0     18
       -> osal_set_event              0      0     18
     SerialApp_Init                   0      0     38
       -> afRegister                  0      0     76
       -> RegisterForKeys             0      0     76
       -> HalUARTInitSPI              0      0     76
       -> InitFM1702SL                0      0     76
       -> HalUARTOpen                 0      0     76
     SerialApp_OTAData                0      0     32
       -> AF_DataRequest              0      0     38
       -> HalLedBlink                 0      0     20
     SerialApp_ProcessEvent           0      0     13
       -> SerialApp_OTAData           0      0     26
       -> osal_start_timerEx          0      0     24
       -> HalLedSet                   0      0     24
       -> HalLedBlink                 0      0     24
       -> osal_set_event              0      0     24
       -> osal_set_event              0      0     24
       -> osal_msg_deallocate         0      0     24
       -> osal_msg_receive            0      0     24
       -> SerialApp_ProcessMSGCmd     0      0     24
       -> SerialApp_OTAData           0      0     26
       -> Request                     0      0     24
       -> ReadCardNum                 0      0     24
       -> block_numset                0      0     24
       -> MIF_READ                    0      0     24
       -> osal_set_event              0      0     24
       -> Onboard_wait                0      0     24
       -> Onboard_wait                0      0     24
       -> osal_start_timerEx          0      0     24
     SerialApp_ProcessMSGCmd          0      0     22
       -> HalLedBlink                 0      0     18
       -> HalLedSet                   0      0     18
       -> Request                     0      0     18
       -> HalLedSet                   0      0     18
       -> ReadCardNum                 0      0     18
       -> block_numset                0      0     18
       -> MIF_READ                    0      0     18
       -> block_numset                0      0     18
       -> MIF_Write                   0      0     18
       -> block_numset                0      0     18
       -> MIF_READ                    0      0     18
       -> block_numset                0      0     18
       -> MIF_Write                   0      0     18
       -> SerialApp_OTAData           0      0     20
     WriteReg                         0      0     21
       -> SPIOneByte                  0      0     18
       -> SPIOneByte                  0      0     18
     block_numset                     0      0     12
     keyto                            2      0      0
       -> block_numset                4      0      0


   Segment part sizes:

     Function/Label                  Bytes
     --------------                  -----
     _A_P0                              1
     _A_P1                              1
     P0DIR                              1
     P1DIR                              1
     SerialApp_ClusterList              4
     SerialApp_SimpleDesc              12
     SerialApp_epDesc                   6
     SerialApp_TaskID                   1
     SampleApp_NwkState                 1
     UART0_Format                      16
     SerialApp_MsgID                    1
     SerialApp_TxAddr                  12
     SerialApp_TxBuf                   20
     SerialApp_TxLen                    1
     RevBuffer                         24
     CardNo                             5
     WriteReg                          27
     ?Subroutine0                       5
     ??Subroutine21_0                   5
     ReadReg                           32
     FM1702BusSel                      43
     ??Subroutine20_0                   5
     Fifo_Write                        50
     ?Subroutine1                       5
     ??Subroutine24_0                   6
     Fifo_Read                         66
     ?Subroutine6                       2
     Judge_Req                         50
     ?Subroutine2                       7
     InitFM1702SL                      74
     ?Subroutine8                      11
     Clear_FIFO                        41
     ?Subroutine14                     11
     Command_Send                      61
     ?Subroutine3                       5
     keyto                             26
     block_numset                       9
     Request                           80
     ?Subroutine5                       2
     ??Subroutine19_0                  12
     ??Subroutine22_0                   5
     Load_key_CPY                      65
     M500HostCodeKey                   71
     ?Subroutine7                       4
     ??Subroutine23_0                   3
     ReadCardNum                       53
     Authentication                    88
     ?Subroutine15                     12
     Select_Card                      102
     Check_UID                         42
     ?Subroutine4                       5
     ?Subroutine13                      2
     AntiColl                          97
     MIF_READ                          63
     MIF_Write                        172
     SerialApp_Init                   182
     ?Subroutine12                     16
     SerialApp_ProcessEvent           396
     ?Subroutine11                      3
     ??Subroutine25_0                  11
     hasCardOld                         1
     hasCardNow                         1
     SerialApp_ProcessMSGCmd          275
     ?Subroutine10                      4
     ?Subroutine17                      7
     ?Subroutine18                     12
     ?Subroutine9                      44
     ?Subroutine16                     15
     receiveData                        2
     secNR                              1
     overage                            2
     Rsp                               16
     SerialApp_OTAData                 92
     SerialApp_CallBack               112
     ??WriteReg?relay                   6
     ??ReadReg?relay                    6
     ??FM1702BusSel?relay               6
     ??Fifo_Write?relay                 6
     ??Fifo_Read?relay                  6
     ??Judge_Req?relay                  6
     ??InitFM1702SL?relay               6
     ??Clear_FIFO?relay                 6
     ??Command_Send?relay               6
     ??keyto?relay                      6
     ??block_numset?relay               6
     ??Request?relay                    6
     ??Load_key_CPY?relay               6
     ??M500HostCodeKey?relay            6
     ??ReadCardNum?relay                6
     ??Authentication?relay             6
     ??Select_Card?relay                6
     ??Check_UID?relay                  6
     ??AntiColl?relay                   6
     ??MIF_READ?relay                   6
     ??MIF_Write?relay                  6
     ??SerialApp_Init?relay             6
     ??SerialApp_ProcessEvent?relay     6
     ??SerialApp_ProcessMSGCmd?relay    6
     ??SerialApp_OTAData?relay          6
     ??SerialApp_CallBack?relay         6

 
 2 588 bytes in segment BANKED_CODE
   156 bytes in segment BANK_RELAYS
     4 bytes in segment SFR_AN
    22 bytes in segment XDATA_ROM_C
   104 bytes in segment XDATA_Z
 
 2 744 bytes of CODE  memory
    22 bytes of CONST memory
     0 bytes of DATA  memory (+ 4 bytes shared)
   104 bytes of XDATA memory

Errors: none
Warnings: none
