###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.1.10194/W32 for 8051         01/Nov/2012  22:56:06 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\PhotoRes\ #
#                          Photo.c                                            #
#    Command line       =  -f I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530 #
#                          -2.5.1a\Projects\zstack\Utilities\SerialApp\CC2530 #
#                          DB\..\..\..\Tools\CC2530DB\f8wEndev.cfg            #
#                          (-DCPU32MHZ -DROOT=__near_func                     #
#                          -DMAC_CFG_TX_DATA_MAX=3 -DMAC_CFG_TX_MAX=6         #
#                          -DMAC_CFG_RX_MAX=3) -f I:\ETC光盘\ETC-WSN光盘\WSN- #
#                          CS源码\ZStack-CC2530-2.5.1a\Projects\zstack\Utilit #
#                          ies\SerialApp\CC2530DB\..\..\..\Tools\CC2530DB\f8w #
#                          Config.cfg (-DZIGBEEPRO -DSECURE=0                 #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0x1002                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 I:\ETC光盘\ETC-WSN光盘\WSN- #
#                          CS源码\ZStack-CC2530-2.5.1a\Projects\zstack\Utilit #
#                          ies\SerialApp\PhotoRes\Photo.c -D NWK_AUTO_POLL    #
#                          -D HAL_UART=TRUE -D SERIAL_APP_PORT=0 -D           #
#                          POWER_SAVING -D NV_INIT -D NV_RESTORE -D PHOTO     #
#                          -lC I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC253 #
#                          0-2.5.1a\Projects\zstack\Utilities\SerialApp\CC253 #
#                          0DB\PhotoResistor\List\ -lA                        #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          PhotoResistor\List\ --diag_suppress Pe001,Pa010    #
#                          -o I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530 #
#                          -2.5.1a\Projects\zstack\Utilities\SerialApp\CC2530 #
#                          DB\PhotoResistor\Obj\ -e --no_code_motion --debug  #
#                          --core=plain --dptr=16,1 --data_model=large        #
#                          --code_model=banked --calling_convention=xdata_ree #
#                          ntrant --place_constants=data_rom                  #
#                          --nr_virtual_regs 16 -I I:\ETC光盘\ETC-WSN光盘\WSN #
#                          -CS源码\ZStack-CC2530-2.5.1a\Projects\zstack\Utili #
#                          ties\SerialApp\CC2530DB\ -I                        #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\PhotoRes\ -I I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ #
#                          ZStack-CC2530-2.5.1a\Projects\zstack\Utilities\Ser #
#                          ialApp\CC2530DB\..\Public\ -I                      #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\ZMain\TI2530DB\ -I                        #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\hal\include\ -I          #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\hal\target\CC2530EB\ -I  #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\mac\include\ -I          #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\mac\high_level\ -I       #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\mac\low_level\srf04\ -I  #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\mac\low_level\srf04\sing #
#                          le_chip\ -I I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZSta #
#                          ck-CC2530-2.5.1a\Projects\zstack\Utilities\SerialA #
#                          pp\CC2530DB\..\..\..\..\..\Components\mt\ -I       #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\osal\include\ -I         #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\services\saddr\ -I       #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\services\sdata\ -I       #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\af\ -I             #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\nwk\ -I            #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\sapi\ -I           #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\sec\ -I            #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\sys\ -I            #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\stack\zdo\ -I            #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\zmac\ -I                 #
#                          I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          ..\..\..\..\..\Components\zmac\f8w\ -Ohz           #
#                          --require_prototypes                               #
#    List file          =  I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          PhotoResistor\List\Photo.lst                       #
#    Object file        =  I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2. #
#                          5.1a\Projects\zstack\Utilities\SerialApp\CC2530DB\ #
#                          PhotoResistor\Obj\Photo.r51                        #
#                                                                             #
#                                                                             #
###############################################################################

I:\ETC光盘\ETC-WSN光盘\WSN-CS源码\ZStack-CC2530-2.5.1a\Projects\zstack\Utilities\SerialApp\PhotoRes\Photo.c
      1          /**************************************************************************************************
      2            Filename:       SerialApp.c
      3            Revised:        $Date: 2009-03-29 10:51:47 -0700 (Sun, 29 Mar 2009) $
      4            Revision:       $Revision: 19585 $
      5          
      6            Description -   Serial Transfer Application (no Profile).
      7          
      8          
      9            Copyright 2004-2009 Texas Instruments Incorporated. All rights reserved.
     10          
     11            IMPORTANT: Your use of this Software is limited to those specific rights
     12            granted under the terms of a software license agreement between the user
     13            who downloaded the software, his/her employer (which must be your employer)
     14            and Texas Instruments Incorporated (the "License").  You may not use this
     15            Software unless you agree to abide by the terms of the License. The License
     16            limits your use, and you acknowledge, that the Software may not be modified,
     17            copied or distributed unless embedded on a Texas Instruments microcontroller
     18            or used solely and exclusively in conjunction with a Texas Instruments radio
     19            frequency transceiver, which is integrated into your product.  Other than for
     20            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     21            works of, modify, distribute, perform, display or sell this Software and/or
     22            its documentation for any purpose.
     23          
     24            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     25            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, 
     26            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE, 
     27            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     28            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     29            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     30            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     31            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     32            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     33            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     34            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     35          
     36            Should you have any questions regarding your right to use this Software,
     37            contact Texas Instruments Incorporated at www.TI.com. 
     38          **************************************************************************************************/
     39          
     40          #include "AF.h"
     41          #include "OnBoard.h"

   \                                 In  segment SFR_AN, at 0xf3
   \   unsigned char volatile __sfr P0SEL
   \                     P0SEL:
   \   000000                DS 1

   \                                 In  segment SFR_AN, at 0xfd
   \   unsigned char volatile __sfr P0DIR
   \                     P0DIR:
   \   000000                DS 1
     42          #include "OSAL_Tasks.h"
     43          #include "ZDApp.h"
     44          #include "ZDObject.h"
     45          #include "ZDProfile.h"
     46          
     47          #include "hal_drivers.h"
     48          #include "hal_key.h"
     49          #if defined ( LCD_SUPPORTED )
     50            #include "hal_lcd.h"
     51          #endif
     52          #include "hal_led.h"
     53          #include "hal_uart.h"
     54          #include "Public.h"
     55          #include "Photo.h"
     56          #include "hal_adc.h"
     57          
     58          /*********************************************************************
     59           * MACROS
     60           */
     61          
     62          /*********************************************************************
     63           * CONSTANTS
     64           */
     65          
     66          #if !defined( SERIAL_APP_PORT )
     67          #define SERIAL_APP_PORT  0
     68          #endif
     69          
     70          #if !defined( SERIAL_APP_BAUD )
     71          #define SERIAL_APP_BAUD  HAL_UART_BR_115200
     72          #endif
     73          
     74          // When the Rx buf space is less than this threshold, invoke the Rx callback.
     75          #if !defined( SERIAL_APP_THRESH )
     76          #define SERIAL_APP_THRESH  64
     77          #endif
     78          
     79          #if !defined( SERIAL_APP_RX_SZ )
     80          #define SERIAL_APP_RX_SZ  128
     81          #endif
     82          
     83          #if !defined( SERIAL_APP_TX_SZ )
     84          #define SERIAL_APP_TX_SZ  128
     85          #endif
     86          
     87          // Millisecs of idle time after a byte is received before invoking Rx callback.
     88          #if !defined( SERIAL_APP_IDLE )
     89          #define SERIAL_APP_IDLE  6
     90          #endif
     91          
     92          // Loopback Rx bytes to Tx for throughput testing.
     93          #if !defined( SERIAL_APP_LOOPBACK )
     94          #define SERIAL_APP_LOOPBACK  FALSE
     95          #endif
     96          
     97          // This is the max byte count per OTA message.
     98          #if !defined( SERIAL_APP_TX_MAX )
     99          #define SERIAL_APP_TX_MAX  20
    100          #endif
    101          
    102          #define SERIAL_APP_RSP_CNT  4
    103          
    104          // This list should be filled with Application specific Cluster IDs.

   \                                 In  segment XDATA_ROM_C, align 1
    105          const cId_t SerialApp_ClusterList[SERIALAPP_MAX_CLUSTERS] =
   \                     SerialApp_ClusterList:
   \   000000   0100         DW 1
   \   000002   0200         DW 2
    106          {
    107            SERIALAPP_CLUSTERID1,
    108            SERIALAPP_CLUSTERID2
    109          };
    110          

   \                                 In  segment XDATA_ROM_C, align 1
    111          const SimpleDescriptionFormat_t SerialApp_SimpleDesc =
   \                     SerialApp_SimpleDesc:
   \   000000   0B           DB 11
   \   000001   050F         DW 3845
   \   000003   0100         DW 1
   \   000005   00           DB 0
   \   000006   02           DB 2
   \   000007   ....         DW SerialApp_ClusterList
   \   000009   02           DB 2
   \   00000A   ....         DW SerialApp_ClusterList
    112          {
    113            SERIALAPP_ENDPOINT,              //  int   Endpoint;
    114            SERIALAPP_PROFID,                //  uint16 AppProfId[2];
    115            SERIALAPP_DEVICEID,              //  uint16 AppDeviceId[2];
    116            SERIALAPP_DEVICE_VERSION,        //  int   AppDevVer:4;
    117            SERIALAPP_FLAGS,                 //  int   AppFlags:4;
    118            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumInClusters;
    119            (cId_t *)SerialApp_ClusterList,  //  byte *pAppInClusterList;
    120            SERIALAPP_MAX_CLUSTERS,          //  byte  AppNumOutClusters;
    121            (cId_t *)SerialApp_ClusterList   //  byte *pAppOutClusterList;
    122          };
    123          

   \                                 In  segment XDATA_ROM_C, align 1
    124          const endPointDesc_t SerialApp_epDesc =
   \                     SerialApp_epDesc:
   \   000000   0B           DB 11
   \   000001   ....         DW SerialApp_TaskID
   \   000003   ....         DW SerialApp_SimpleDesc
   \   000005   00           DB 0
    125          {
    126            SERIALAPP_ENDPOINT,
    127           &SerialApp_TaskID,
    128            (SimpleDescriptionFormat_t *)&SerialApp_SimpleDesc,
    129            noLatencyReqs
    130          };
    131          
    132          /*********************************************************************
    133           * TYPEDEFS
    134           */
    135          
    136          /*********************************************************************
    137           * GLOBAL VARIABLES
    138           */
    139          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    140          uint8 SerialApp_TaskID;    // Task ID for internal task/event processing.
   \                     SerialApp_TaskID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    141          devStates_t  SampleApp_NwkState;
   \                     SampleApp_NwkState:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    142          static UART_Format UART0_Format;
   \                     UART0_Format:
   \   000000                DS 16
   \   000010                REQUIRE __INIT_XDATA_Z
    143          
    144          /*********************************************************************
    145           * EXTERNAL VARIABLES
    146           */
    147          
    148          /*********************************************************************
    149           * EXTERNAL FUNCTIONS
    150           */
    151          
    152          /*********************************************************************
    153           * LOCAL VARIABLES
    154           */
    155          

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    156          static uint8 SerialApp_MsgID;
   \                     SerialApp_MsgID:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    157          static afAddrType_t SerialApp_TxAddr;
   \                     SerialApp_TxAddr:
   \   000000                DS 12
   \   00000C                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    158          static uint8 SerialApp_TxBuf[SERIAL_APP_TX_MAX];
   \                     SerialApp_TxBuf:
   \   000000                DS 20
   \   000014                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    159          static uint8 SerialApp_TxLen;
   \                     SerialApp_TxLen:
   \   000000                DS 1
   \   000001                REQUIRE __INIT_XDATA_Z

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    160          static uint16 PhotoResult;
   \                     PhotoResult:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    161          /*********************************************************************
    162           * LOCAL FUNCTIONS
    163           */
    164          
    165          static void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt );
    166          void SerialApp_OTAData(afAddrType_t *txaddr,uint8 ID,void *p,uint8 len);
    167          static void SerialApp_CallBack(uint8 port, uint8 event);
    168          /*********************************************************************
    169           * @fn      SerialApp_Init
    170           *
    171           * @brief   This is called during OSAL tasks' initialization.
    172           *
    173           * @param   task_id - the Task ID assigned by OSAL.
    174           *
    175           * @return  none
    176           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    177          void SerialApp_Init( uint8 task_id )
   \                     SerialApp_Init:
    178          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 29
   \   000005   74E3         MOV     A,#-0x1d
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   E9           MOV     A,R1
   \   00000B   FE           MOV     R6,A
    179            halUARTCfg_t uartConfig;
    180          
    181            SerialApp_TaskID = task_id;
   \   00000C   90....       MOV     DPTR,#SerialApp_TaskID
   \   00000F   F0           MOVX    @DPTR,A
    182            P0SEL |= 0x01;
   \   000010   43F301       ORL     0xf3,#0x1
    183            P0DIR &= ~0x01;
   \   000013   53FDFE       ANL     0xfd,#0xfe
    184          
    185            afRegister( (endPointDesc_t *)&SerialApp_epDesc );
   \   000016                ; Setup parameters for call to function afRegister
   \   000016   7A..         MOV     R2,#SerialApp_epDesc & 0xff
   \   000018   7B..         MOV     R3,#(SerialApp_epDesc >> 8) & 0xff
   \   00001A   12....       LCALL   ??afRegister?relay
    186          
    187            RegisterForKeys( task_id );
   \   00001D                ; Setup parameters for call to function RegisterForKeys
   \   00001D   EE           MOV     A,R6
   \   00001E   F9           MOV     R1,A
   \   00001F   12....       LCALL   ??RegisterForKeys?relay
    188          
    189            uartConfig.configured           = TRUE;              // 2x30 don't care - see uart driver.
   \   000022   85..82       MOV     DPL,?XSP + 0
   \   000025   85..83       MOV     DPH,?XSP + 1
   \   000028   7401         MOV     A,#0x1
   \   00002A   F0           MOVX    @DPTR,A
    190            uartConfig.baudRate             = SERIAL_APP_BAUD;
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   7404         MOV     A,#0x4
   \   000030   F0           MOVX    @DPTR,A
    191            uartConfig.flowControl          = FALSE;
   \   000031   7402         MOV     A,#0x2
   \   000033   12....       LCALL   ?XSTACK_DISP0_8
   \   000036   E4           CLR     A
   \   000037   F0           MOVX    @DPTR,A
    192            uartConfig.flowControlThreshold = SERIAL_APP_THRESH; // 2x30 don't care - see uart driver.
   \   000038   7403         MOV     A,#0x3
   \   00003A   12....       LCALL   ?XSTACK_DISP0_8
   \   00003D   7440         MOV     A,#0x40
   \   00003F   F0           MOVX    @DPTR,A
   \   000040   A3           INC     DPTR
   \   000041   E4           CLR     A
   \   000042   F0           MOVX    @DPTR,A
    193            uartConfig.rx.maxBufSize        = SERIAL_APP_RX_SZ;  // 2x30 don't care - see uart driver.
   \   000043   740A         MOV     A,#0xa
   \   000045   12....       LCALL   ?XSTACK_DISP0_8
   \   000048   7480         MOV     A,#-0x80
   \   00004A   F0           MOVX    @DPTR,A
   \   00004B   A3           INC     DPTR
   \   00004C   E4           CLR     A
   \   00004D   F0           MOVX    @DPTR,A
    194            uartConfig.tx.maxBufSize        = SERIAL_APP_TX_SZ;  // 2x30 don't care - see uart driver.
   \   00004E   7412         MOV     A,#0x12
   \   000050   12....       LCALL   ?XSTACK_DISP0_8
   \   000053   7480         MOV     A,#-0x80
   \   000055   F0           MOVX    @DPTR,A
   \   000056   A3           INC     DPTR
   \   000057   E4           CLR     A
   \   000058   F0           MOVX    @DPTR,A
    195            uartConfig.idleTimeout          = SERIAL_APP_IDLE;   // 2x30 don't care - see uart driver.
   \   000059   7405         MOV     A,#0x5
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   7406         MOV     A,#0x6
   \   000060   F0           MOVX    @DPTR,A
    196            uartConfig.intEnable            = TRUE;              // 2x30 don't care - see uart driver.
   \   000061   7416         MOV     A,#0x16
   \   000063   12....       LCALL   ?XSTACK_DISP0_8
   \   000066   7401         MOV     A,#0x1
   \   000068   F0           MOVX    @DPTR,A
    197            uartConfig.callBackFunc         = SerialApp_CallBack;
   \   000069   741B         MOV     A,#0x1b
   \   00006B   12....       LCALL   ?XSTACK_DISP0_8
   \   00006E   74..         MOV     A,#??SerialApp_CallBack?relay & 0xff
   \   000070   F0           MOVX    @DPTR,A
   \   000071   A3           INC     DPTR
   \   000072   74..         MOV     A,#(??SerialApp_CallBack?relay >> 8) & 0xff
   \   000074   F0           MOVX    @DPTR,A
    198            HalUARTOpen (SERIAL_APP_PORT, &uartConfig);
   \   000075                ; Setup parameters for call to function HalUARTOpen
   \   000075   85..82       MOV     DPL,?XSP + 0
   \   000078   85..83       MOV     DPH,?XSP + 1
   \   00007B   AA82         MOV     R2,DPL
   \   00007D   AB83         MOV     R3,DPH
   \   00007F   7900         MOV     R1,#0x0
   \   000081   12....       LCALL   ??HalUARTOpen?relay
    199            
    200            UART0_Format.Header_1 = 0xee;
   \   000084   90....       MOV     DPTR,#UART0_Format
   \   000087   74EE         MOV     A,#-0x12
   \   000089   F0           MOVX    @DPTR,A
    201            UART0_Format.Header_2 = 0xcc;
   \   00008A   A3           INC     DPTR
   \   00008B   74CC         MOV     A,#-0x34
   \   00008D   F0           MOVX    @DPTR,A
    202            UART0_Format.NodeSeq  = 0x01;
   \   00008E   A3           INC     DPTR
   \   00008F   7401         MOV     A,#0x1
   \   000091   F0           MOVX    @DPTR,A
    203            UART0_Format.NodeID   = PhotoRes;
   \   000092   A3           INC     DPTR
   \   000093   04           INC     A
   \   000094   F0           MOVX    @DPTR,A
    204            UART0_Format.Tailer   = 0xff;
   \   000095   90....       MOV     DPTR,#UART0_Format + 15
   \   000098   74FF         MOV     A,#-0x1
   \   00009A   F0           MOVX    @DPTR,A
    205            
    206            SerialApp_TxAddr.addrMode =(afAddrMode_t)Addr16Bit;//发送地址初始化
   \   00009B   90....       MOV     DPTR,#SerialApp_TxAddr + 8
   \   00009E   7402         MOV     A,#0x2
   \   0000A0   F0           MOVX    @DPTR,A
    207            SerialApp_TxAddr.endPoint = SERIALAPP_ENDPOINT;
   \   0000A1   A3           INC     DPTR
   \   0000A2   740B         MOV     A,#0xb
   \   0000A4   F0           MOVX    @DPTR,A
    208            SerialApp_TxAddr.addr.shortAddr = 0x0000;
   \   0000A5   90....       MOV     DPTR,#SerialApp_TxAddr
   \   0000A8   E4           CLR     A
   \   0000A9   F0           MOVX    @DPTR,A
   \   0000AA   A3           INC     DPTR
   \   0000AB   F0           MOVX    @DPTR,A
    209            TXPOWER = 0xf5;
   \   0000AC   906190       MOV     DPTR,#0x6190
   \   0000AF   74F5         MOV     A,#-0xb
   \   0000B1   F0           MOVX    @DPTR,A
    210          }
   \   0000B2   741D         MOV     A,#0x1d
   \   0000B4   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000B7                REQUIRE ?Subroutine0
   \   0000B7                REQUIRE P0SEL
   \   0000B7                REQUIRE P0DIR
   \   0000B7                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   7F01         MOV     R7,#0x1
   \   000002   02....       LJMP    ?BANKED_LEAVE_XDATA
    211          
    212          /*********************************************************************
    213           * @fn      SerialApp_ProcessEvent
    214           *
    215           * @brief   Generic Application Task event processor.
    216           *
    217           * @param   task_id  - The OSAL assigned task ID.
    218           * @param   events   - Bit map of events to process.
    219           *
    220           * @return  Event flags of all unprocessed events.
    221           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    222          UINT16 SerialApp_ProcessEvent( uint8 task_id, UINT16 events )
   \                     SerialApp_ProcessEvent:
    223          {
   \   000000   74F4         MOV     A,#-0xc
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 12
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
   \   000007   EB           MOV     A,R3
   \   000008   FF           MOV     R7,A
    224            (void)task_id;  // Intentionally unreferenced parameter
    225            
    226            if ( events & SYS_EVENT_MSG )
   \   000009   5480         ANL     A,#0x80
   \   00000B   7075         JNZ     ??SerialApp_ProcessEvent_0
    227            {
    228              afIncomingMSGPacket_t *MSGpkt;
    229          
    230              while ( (MSGpkt = (afIncomingMSGPacket_t *)osal_msg_receive( SerialApp_TaskID )) )
    231              {
    232                switch ( MSGpkt->hdr.event )
    233                {         
    234                case KEY_CHANGE:
    235                  //SerialApp_HandleKeys( ((keyChange_t *)MSGpkt)->state, ((keyChange_t *)MSGpkt)->keys );
    236                  break;
    237          
    238                case AF_INCOMING_MSG_CMD:
    239                  SerialApp_ProcessMSGCmd( MSGpkt );
    240                  break;
    241          
    242                case ZDO_STATE_CHANGE:
    243                    SampleApp_NwkState = (devStates_t)(MSGpkt->hdr.status);
    244                    if(SampleApp_NwkState == DEV_END_DEVICE) //判定当前设备类型
    245                    {
    246                      HalLedSet(HAL_LED_1,HAL_LED_MODE_ON);
    247                      HalLedBlink(HAL_LED_2,5,50,200);
    248                      osal_set_event(SerialApp_TaskID, PERIOD_EVT); //启动周期消息
    249                      osal_set_event(SerialApp_TaskID, PHOTO_READ_EVT); //启动光照检测
    250                    }
    251                  break;
    252                default:
    253                  break;
    254                }
    255          
    256                osal_msg_deallocate( (uint8 *)MSGpkt );
    257              }
    258          
    259              return ( events ^ SYS_EVENT_MSG );
    260            }
    261            
    262            if ( events & PERIOD_EVT ) //周期消息处理
   \   00000D   EE           MOV     A,R6
   \   00000E   5402         ANL     A,#0x2
   \   000010   7003         JNZ     $+5
   \   000012   02....       LJMP    ??SerialApp_ProcessEvent_1 & 0xFFFF
    263            {
    264              UART0_Format.Command = MSG_PERIOD;
   \   000015   90....       MOV     DPTR,#UART0_Format + 4
   \   000018   74AA         MOV     A,#-0x56
   \   00001A   F0           MOVX    @DPTR,A
    265              UART0_Format.Data[0] = 0x00;
   \   00001B   A3           INC     DPTR
   \   00001C   E4           CLR     A
   \   00001D   F0           MOVX    @DPTR,A
    266              UART0_Format.Data[1] = 0x00; 
   \   00001E   A3           INC     DPTR
   \   00001F   F0           MOVX    @DPTR,A
    267              SerialApp_OTAData(&SerialApp_TxAddr, SERIALAPP_CLUSTERID1, &UART0_Format, sizeof(UART_Format));
   \   000020                ; Setup parameters for call to function SerialApp_OTAData
   \   000020   75..10       MOV     ?V0 + 0,#0x10
   \   000023   78..         MOV     R0,#?V0 + 0
   \   000025   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000028   7C..         MOV     R4,#UART0_Format & 0xff
   \   00002A   7D..         MOV     R5,#(UART0_Format >> 8) & 0xff
   \   00002C   7901         MOV     R1,#0x1
   \   00002E   7A..         MOV     R2,#SerialApp_TxAddr & 0xff
   \   000030   7B..         MOV     R3,#(SerialApp_TxAddr >> 8) & 0xff
   \   000032   12....       LCALL   ??SerialApp_OTAData?relay
   \   000035   7401         MOV     A,#0x1
   \   000037   12....       LCALL   ?DEALLOC_XSTACK8
    268              osal_start_timerEx(SerialApp_TaskID, PERIOD_EVT, 5000);
   \   00003A                ; Setup parameters for call to function osal_start_timerEx
   \   00003A   7C88         MOV     R4,#-0x78
   \   00003C   7D13         MOV     R5,#0x13
   \   00003E   7A02         MOV     R2,#0x2
   \   000040   7B00         MOV     R3,#0x0
   \   000042   90....       MOV     DPTR,#SerialApp_TaskID
   \   000045   E0           MOVX    A,@DPTR
   \   000046   F9           MOV     R1,A
   \   000047   12....       LCALL   ??osal_start_timerEx?relay
    269              return ( events ^ PERIOD_EVT );
   \   00004A   EE           MOV     A,R6
   \   00004B   6402         XRL     A,#0x2
   \                     ??SerialApp_ProcessEvent_2:
   \   00004D   FA           MOV     R2,A
   \   00004E   EF           MOV     A,R7
   \                     ??SerialApp_ProcessEvent_3:
   \   00004F   FB           MOV     R3,A
   \   000050   02....       LJMP    ??SerialApp_ProcessEvent_4 & 0xFFFF
    270            }
   \                     ??SerialApp_ProcessEvent_5:
   \   000053   A3           INC     DPTR
   \   000054   E0           MOVX    A,@DPTR
   \   000055   90....       MOV     DPTR,#SampleApp_NwkState
   \   000058   F0           MOVX    @DPTR,A
   \   000059   6406         XRL     A,#0x6
   \   00005B   701E         JNZ     ??CrossCallReturnLabel_1
   \   00005D                ; Setup parameters for call to function HalLedSet
   \   00005D   7A01         MOV     R2,#0x1
   \   00005F   7901         MOV     R1,#0x1
   \   000061   12....       LCALL   ??HalLedSet?relay
   \   000064                ; Setup parameters for call to function HalLedBlink
   \   000064   7CC8         MOV     R4,#-0x38
   \   000066   7D00         MOV     R5,#0x0
   \   000068   7B32         MOV     R3,#0x32
   \   00006A   7A05         MOV     R2,#0x5
   \   00006C   7902         MOV     R1,#0x2
   \   00006E   12....       LCALL   ??HalLedBlink?relay
   \   000071                ; Setup parameters for call to function osal_set_event
   \   000071   7A02         MOV     R2,#0x2
   \   000073   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_0:
   \   000076                ; Setup parameters for call to function osal_set_event
   \   000076   7A04         MOV     R2,#0x4
   \   000078   12....       LCALL   ?Subroutine1 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   00007B                ; Setup parameters for call to function osal_msg_deallocate
   \   00007B   AA..         MOV     R2,?V0 + 0
   \   00007D   AB..         MOV     R3,?V0 + 1
   \   00007F   12....       LCALL   ??osal_msg_deallocate?relay
   \                     ??SerialApp_ProcessEvent_0:
   \   000082                ; Setup parameters for call to function osal_msg_receive
   \   000082   90....       MOV     DPTR,#SerialApp_TaskID
   \   000085   E0           MOVX    A,@DPTR
   \   000086   F9           MOV     R1,A
   \   000087   12....       LCALL   ??osal_msg_receive?relay
   \   00008A   8A..         MOV     ?V0 + 0,R2
   \   00008C   8B..         MOV     ?V0 + 1,R3
   \   00008E   EA           MOV     A,R2
   \   00008F   45..         ORL     A,?V0 + 1
   \   000091   6042         JZ      ??SerialApp_ProcessEvent_6
   \   000093   8A82         MOV     DPL,R2
   \   000095   8B83         MOV     DPH,R3
   \   000097   E0           MOVX    A,@DPTR
   \   000098   24E6         ADD     A,#-0x1a
   \   00009A   6006         JZ      ??SerialApp_ProcessEvent_7
   \   00009C   2449         ADD     A,#0x49
   \   00009E   60B3         JZ      ??SerialApp_ProcessEvent_5
   \   0000A0   80D9         SJMP    ??CrossCallReturnLabel_1
   \                     ??SerialApp_ProcessEvent_7:
   \   0000A2   A3           INC     DPTR
   \   0000A3   A3           INC     DPTR
   \   0000A4   A3           INC     DPTR
   \   0000A5   A3           INC     DPTR
   \   0000A6   E0           MOVX    A,@DPTR
   \   0000A7   6401         XRL     A,#0x1
   \   0000A9   7002         JNZ     ??SerialApp_ProcessEvent_8
   \   0000AB   A3           INC     DPTR
   \   0000AC   E0           MOVX    A,@DPTR
   \                     ??SerialApp_ProcessEvent_8:
   \   0000AD   70CC         JNZ     ??CrossCallReturnLabel_1
   \   0000AF   EA           MOV     A,R2
   \   0000B0   2422         ADD     A,#0x22
   \   0000B2   F582         MOV     DPL,A
   \   0000B4   EB           MOV     A,R3
   \   0000B5   3400         ADDC    A,#0x0
   \   0000B7   F583         MOV     DPH,A
   \   0000B9   E0           MOVX    A,@DPTR
   \   0000BA   F8           MOV     R0,A
   \   0000BB   A3           INC     DPTR
   \   0000BC   E0           MOVX    A,@DPTR
   \   0000BD   F9           MOV     R1,A
   \   0000BE   90....       MOV     DPTR,#??receiveData
   \   0000C1   E8           MOV     A,R0
   \   0000C2   F0           MOVX    @DPTR,A
   \   0000C3   A3           INC     DPTR
   \   0000C4   E9           MOV     A,R1
   \   0000C5   F0           MOVX    @DPTR,A
   \   0000C6                ; Setup parameters for call to function HalLedBlink
   \   0000C6   7CC8         MOV     R4,#-0x38
   \   0000C8   7D00         MOV     R5,#0x0
   \   0000CA   7B32         MOV     R3,#0x32
   \   0000CC   7A01         MOV     R2,#0x1
   \   0000CE   7901         MOV     R1,#0x1
   \   0000D0   12....       LCALL   ??HalLedBlink?relay
   \   0000D3   80A6         SJMP    ??CrossCallReturnLabel_1
   \                     ??SerialApp_ProcessEvent_6:
   \   0000D5   EE           MOV     A,R6
   \   0000D6   FA           MOV     R2,A
   \   0000D7   EF           MOV     A,R7
   \   0000D8   6480         XRL     A,#0x80
   \   0000DA   02....       LJMP    ??SerialApp_ProcessEvent_3 & 0xFFFF
    271            
    272            if ( events & SERIALAPP_SEND_EVT ) //发送RF消息
   \                     ??SerialApp_ProcessEvent_1:
   \   0000DD   EE           MOV     A,R6
   \   0000DE   A2E0         MOV     C,0xE0 /* A   */.0
   \   0000E0   5020         JNC     ??SerialApp_ProcessEvent_9
    273            {
    274              SerialApp_OTAData(&SerialApp_TxAddr,SERIALAPP_CLUSTERID1, &UART0_Format, sizeof(UART_Format));
   \   0000E2                ; Setup parameters for call to function SerialApp_OTAData
   \   0000E2   75..10       MOV     ?V0 + 0,#0x10
   \   0000E5   78..         MOV     R0,#?V0 + 0
   \   0000E7   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   0000EA   7C..         MOV     R4,#UART0_Format & 0xff
   \   0000EC   7D..         MOV     R5,#(UART0_Format >> 8) & 0xff
   \   0000EE   7901         MOV     R1,#0x1
   \   0000F0   7A..         MOV     R2,#SerialApp_TxAddr & 0xff
   \   0000F2   7B..         MOV     R3,#(SerialApp_TxAddr >> 8) & 0xff
   \   0000F4   12....       LCALL   ??SerialApp_OTAData?relay
   \   0000F7   7401         MOV     A,#0x1
   \   0000F9   12....       LCALL   ?DEALLOC_XSTACK8
    275              return ( events ^ SERIALAPP_SEND_EVT );
   \   0000FC   EE           MOV     A,R6
   \   0000FD   6401         XRL     A,#0x1
   \   0000FF   02....       LJMP    ??SerialApp_ProcessEvent_2 & 0xFFFF
    276            }
    277          
    278            if ( events & PHOTO_READ_EVT )  //查看光敏电阻状态
   \                     ??SerialApp_ProcessEvent_9:
   \   000102   5404         ANL     A,#0x4
   \   000104   6040         JZ      ??SerialApp_ProcessEvent_10
    279            {
    280              PhotoResult = HalAdcRead (HAL_ADC_CHANNEL_0 ,HAL_ADC_RESOLUTION_10);//0-512
   \   000106                ; Setup parameters for call to function HalAdcRead
   \   000106   7A02         MOV     R2,#0x2
   \   000108   7900         MOV     R1,#0x0
   \   00010A   12....       LCALL   ??HalAdcRead?relay
   \   00010D   90....       MOV     DPTR,#PhotoResult
   \   000110   EA           MOV     A,R2
   \   000111   F0           MOVX    @DPTR,A
   \   000112   A3           INC     DPTR
   \   000113   EB           MOV     A,R3
   \   000114   F0           MOVX    @DPTR,A
    281              UART0_Format.Command = 0x01;
   \   000115   90....       MOV     DPTR,#UART0_Format + 4
   \   000118   7401         MOV     A,#0x1
   \   00011A   F0           MOVX    @DPTR,A
    282              UART0_Format.Data[0] = PhotoResult>>8;
   \   00011B   90....       MOV     DPTR,#PhotoResult + 1
   \   00011E   E0           MOVX    A,@DPTR
   \   00011F   90....       MOV     DPTR,#UART0_Format + 5
   \   000122   F0           MOVX    @DPTR,A
    283              UART0_Format.Data[1] = PhotoResult; 
   \   000123   90....       MOV     DPTR,#PhotoResult
   \   000126   E0           MOVX    A,@DPTR
   \   000127   90....       MOV     DPTR,#UART0_Format + 6
   \   00012A   F0           MOVX    @DPTR,A
    284              osal_set_event(SerialApp_TaskID, SERIALAPP_SEND_EVT);
   \   00012B                ; Setup parameters for call to function osal_set_event
   \   00012B   7A01         MOV     R2,#0x1
   \   00012D   12....       LCALL   ?Subroutine1 & 0xFFFF
    285              osal_start_timerEx(SerialApp_TaskID, PHOTO_READ_EVT, 1000);
   \                     ??CrossCallReturnLabel_2:
   \   000130                ; Setup parameters for call to function osal_start_timerEx
   \   000130   7CE8         MOV     R4,#-0x18
   \   000132   7D03         MOV     R5,#0x3
   \   000134   7A04         MOV     R2,#0x4
   \   000136   7B00         MOV     R3,#0x0
   \   000138   90....       MOV     DPTR,#SerialApp_TaskID
   \   00013B   E0           MOVX    A,@DPTR
   \   00013C   F9           MOV     R1,A
   \   00013D   12....       LCALL   ??osal_start_timerEx?relay
    286              
    287              return ( events ^ PHOTO_READ_EVT );
   \   000140   EE           MOV     A,R6
   \   000141   6404         XRL     A,#0x4
   \   000143   02....       LJMP    ??SerialApp_ProcessEvent_2 & 0xFFFF
    288            }
    289          
    290            return ( 0 );  // Discard unknown events.
   \                     ??SerialApp_ProcessEvent_10:
   \   000146   7A00         MOV     R2,#0x0
   \   000148   7B00         MOV     R3,#0x0
   \                     ??SerialApp_ProcessEvent_4:
   \   00014A   7F04         MOV     R7,#0x4
   \   00014C   02....       LJMP    ?BANKED_LEAVE_XDATA
    291          }

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   7B00         MOV     R3,#0x0
   \   000002   90....       MOV     DPTR,#SerialApp_TaskID
   \   000005   E0           MOVX    A,@DPTR
   \   000006   F9           MOV     R1,A
   \   000007   12....       LCALL   ??osal_set_event?relay
   \   00000A   22           RET
    292          
    293          /*********************************************************************
    294           * @fn      SerialApp_ProcessMSGCmd
    295           *
    296           * @brief   Data message processor callback. This function processes
    297           *          any incoming data - probably from other devices. Based
    298           *          on the cluster ID, perform the intended action.
    299           *
    300           * @param   pkt - pointer to the incoming message packet
    301           *
    302           * @return  TRUE if the 'pkt' parameter is being used and will be freed later,
    303           *          FALSE otherwise.
    304           */
    305          void SerialApp_ProcessMSGCmd( afIncomingMSGPacket_t *pkt )  //处理接收到的RF消息
    306          {

   \                                 In  segment XDATA_Z, align 1, keep-with-next
    307            static UART_Format *receiveData;
   \                     ??receiveData:
   \   000000                DS 2
   \   000002                REQUIRE __INIT_XDATA_Z
    308            switch ( pkt->clusterId )
    309            {
    310             case SERIALAPP_CLUSTERID1:  //处理各个传感器节数据    
    311               receiveData = (UART_Format *)(pkt->cmd.Data);
    312               HalLedBlink(HAL_LED_1,1,50,200);
    313               if((receiveData->Header_1==0xcc)&&(receiveData->Header_2==0xee)&&(receiveData->Tailer==0xff)) //校验包头包尾
    314               {
    315                 if(receiveData->NodeID == PhotoRes) //地址
    316                 {
    317                   
    318                 }
    319               }
    320              break;
    321          
    322            case SERIALAPP_CLUSTERID2:
    323              break;
    324          
    325              default:
    326                break;
    327            }
    328          }
    329          
    330          /*********************************************************************
    331           */
    332          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    333          void SerialApp_OTAData(afAddrType_t *txaddr, uint8 cID, void *p, uint8 len) //发送函数
   \                     SerialApp_OTAData:
    334          {
   \   000000   74F6         MOV     A,#-0xa
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 10
   \   000005                ; Auto size: 0
   \   000005   E9           MOV     A,R1
   \   000006   FE           MOV     R6,A
   \   000007   740A         MOV     A,#0xa
   \   000009   12....       LCALL   ?XSTACK_DISP0_8
   \   00000C   E0           MOVX    A,@DPTR
   \   00000D   F9           MOV     R1,A
    335            if (afStatus_SUCCESS != AF_DataRequest(txaddr, //发送地址
    336                                                     (endPointDesc_t *)&SerialApp_epDesc, //endpoint描述
    337                                                      cID, //clusterID
    338                                                      len, p, //发送数据包的长度和地址
    339                                                      &SerialApp_MsgID, 0, AF_DEFAULT_RADIUS))
   \   00000E                ; Setup parameters for call to function AF_DataRequest
   \   00000E   75..1E       MOV     ?V0 + 0,#0x1e
   \   000011   78..         MOV     R0,#?V0 + 0
   \   000013   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000016   75....       MOV     ?V0 + 0,#SerialApp_MsgID & 0xff
   \   000019   75....       MOV     ?V0 + 1,#(SerialApp_MsgID >> 8) & 0xff
   \   00001C   78..         MOV     R0,#?V0 + 0
   \   00001E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000021   8C..         MOV     ?V0 + 0,R4
   \   000023   8D..         MOV     ?V0 + 1,R5
   \   000025   78..         MOV     R0,#?V0 + 0
   \   000027   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00002A   89..         MOV     ?V0 + 0,R1
   \   00002C   75..00       MOV     ?V0 + 1,#0x0
   \   00002F   78..         MOV     R0,#?V0 + 0
   \   000031   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000034   8E..         MOV     ?V0 + 0,R6
   \   000036   78..         MOV     R0,#?V0 + 0
   \   000038   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00003B   7900         MOV     R1,#0x0
   \   00003D   7C..         MOV     R4,#SerialApp_epDesc & 0xff
   \   00003F   7D..         MOV     R5,#(SerialApp_epDesc >> 8) & 0xff
   \   000041   12....       LCALL   ??AF_DataRequest?relay
   \   000044   7409         MOV     A,#0x9
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   E9           MOV     A,R1
   \   00004A   700D         JNZ     ??SerialApp_OTAData_0
    340            {
    341            }
    342            else
    343            {
    344              HalLedBlink(HAL_LED_1,1,50,200);
   \   00004C                ; Setup parameters for call to function HalLedBlink
   \   00004C   7CC8         MOV     R4,#-0x38
   \   00004E   7D00         MOV     R5,#0x0
   \   000050   7B32         MOV     R3,#0x32
   \   000052   7A01         MOV     R2,#0x1
   \   000054   7901         MOV     R1,#0x1
   \   000056   12....       LCALL   ??HalLedBlink?relay
    345            }
    346          }
   \                     ??SerialApp_OTAData_0:
   \   000059   7F02         MOV     R7,#0x2
   \   00005B   02....       LJMP    ?BANKED_LEAVE_XDATA
    347          
    348          /*********************************************************************
    349           * @fn      SerialApp_CallBack
    350           *
    351           * @brief   Send data OTA.
    352           *
    353           * @param   port - UART port.
    354           * @param   event - the UART port event flag.
    355           *
    356           * @return  none
    357           */

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    358          static void SerialApp_CallBack(uint8 port, uint8 event)
   \                     SerialApp_CallBack:
    359          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
    360            (void)port;
    361          
    362            if ((event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT)) && !SerialApp_TxLen) //串口接收到数据包
   \   000007   7407         MOV     A,#0x7
   \   000009   5E           ANL     A,R6
   \   00000A   6018         JZ      ??SerialApp_CallBack_0
   \   00000C   90....       MOV     DPTR,#SerialApp_TxLen
   \   00000F   E0           MOVX    A,@DPTR
   \   000010   7012         JNZ     ??SerialApp_CallBack_0
    363            {
    364              SerialApp_TxLen = HalUARTRead(SERIAL_APP_PORT, SerialApp_TxBuf, SERIAL_APP_TX_MAX); //将串口数据读入buf
   \   000012                ; Setup parameters for call to function HalUARTRead
   \   000012   7C14         MOV     R4,#0x14
   \   000014   7D00         MOV     R5,#0x0
   \   000016   7A..         MOV     R2,#SerialApp_TxBuf & 0xff
   \   000018   7B..         MOV     R3,#(SerialApp_TxBuf >> 8) & 0xff
   \   00001A   7900         MOV     R1,#0x0
   \   00001C   12....       LCALL   ??HalUARTRead?relay
    365              SerialApp_TxLen = 0;  
   \   00001F   90....       MOV     DPTR,#SerialApp_TxLen
   \   000022   E4           CLR     A
   \   000023   F0           MOVX    @DPTR,A
    366            }
    367          }
   \                     ??SerialApp_CallBack_0:
   \   000024   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_Init?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_Init

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_ProcessEvent?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_ProcessEvent

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_OTAData?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_OTAData

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??SerialApp_CallBack?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    SerialApp_CallBack
    368          
    369          /*********************************************************************
    370          *********************************************************************/

   Maximum stack usage in bytes:

     Function                 ISTACK PSTACK XSTACK
     --------                 ------ ------ ------
     SerialApp_CallBack           0      0      9
       -> HalUARTRead             0      0     18
     SerialApp_Init               0      0     38
       -> afRegister              0      0     76
       -> RegisterForKeys         0      0     76
       -> HalUARTOpen             0      0     76
     SerialApp_OTAData            0      0     32
       -> AF_DataRequest          0      0     38
       -> HalLedBlink             0      0     20
     SerialApp_ProcessEvent       0      0     13
       -> SerialApp_OTAData       0      0     26
       -> osal_start_timerEx      0      0     24
       -> HalLedSet               0      0     24
       -> HalLedBlink             0      0     24
       -> osal_set_event          0      0     24
       -> osal_set_event          0      0     24
       -> osal_msg_deallocate     0      0     24
       -> osal_msg_receive        0      0     24
       -> HalLedBlink             0      0     24
       -> SerialApp_OTAData       0      0     26
       -> HalAdcRead              0      0     24
       -> osal_set_event          0      0     24
       -> osal_start_timerEx      0      0     24


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     P0SEL                             1
     P0DIR                             1
     SerialApp_ClusterList             4
     SerialApp_SimpleDesc             12
     SerialApp_epDesc                  6
     SerialApp_TaskID                  1
     SampleApp_NwkState                1
     UART0_Format                     16
     SerialApp_MsgID                   1
     SerialApp_TxAddr                 12
     SerialApp_TxBuf                  20
     SerialApp_TxLen                   1
     PhotoResult                       2
     SerialApp_Init                  183
     ?Subroutine0                      5
     SerialApp_ProcessEvent          335
     ?Subroutine1                     11
     receiveData                       2
     SerialApp_OTAData                94
     SerialApp_CallBack               39
     ??SerialApp_Init?relay            6
     ??SerialApp_ProcessEvent?relay    6
     ??SerialApp_OTAData?relay         6
     ??SerialApp_CallBack?relay        6

 
 667 bytes in segment BANKED_CODE
  24 bytes in segment BANK_RELAYS
   2 bytes in segment SFR_AN
  22 bytes in segment XDATA_ROM_C
  56 bytes in segment XDATA_Z
 
 691 bytes of CODE  memory
  22 bytes of CONST memory
   0 bytes of DATA  memory (+ 2 bytes shared)
  56 bytes of XDATA memory

Errors: none
Warnings: none
